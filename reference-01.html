
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seer - Chat Interface</title>
    <link rel="preload" as="style" href="https://seer.test/build/assets/app-CIqgeAyb.css" /><link rel="modulepreload" as="script" href="https://seer.test/build/assets/app-22OXdLpX.js" /><link rel="stylesheet" href="https://seer.test/build/assets/app-CIqgeAyb.css" data-navigate-track="reload" /><script type="module" src="https://seer.test/build/assets/app-22OXdLpX.js" data-navigate-track="reload"></script>    <style>
        /* Pixelated corner effects inspired by pixel-style.jpg */
        .pixel-corner {
            position: relative;
        }

        .pixel-corner::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background:
                radial-gradient(circle at 2px 2px, currentColor 1px, transparent 1px),
                radial-gradient(circle at 2px calc(100% - 2px), currentColor 1px, transparent 1px),
                radial-gradient(circle at calc(100% - 2px) 2px, currentColor 1px, transparent 1px),
                radial-gradient(circle at calc(100% - 2px) calc(100% - 2px), currentColor 1px, transparent 1px);
            background-size: 4px 4px;
            background-repeat: no-repeat;
            pointer-events: none;
            z-index: -1;
        }

        .pixel-card {
            position: relative;
            border: 0.5px solid rgba(255, 255, 255, 0.1);
            background: rgba(36, 43, 61, 0.8);
            border-radius: 3px;
        }

        .pixel-card-pink {
            border-color: #FF1493;
            background: linear-gradient(135deg, rgba(255, 20, 147, 0.1) 0%, rgba(255, 20, 147, 0.05) 100%);
        }

        .pixel-card-blue {
            border-color: #00BFFF;
            background: linear-gradient(135deg, rgba(0, 191, 255, 0.1) 0%, rgba(0, 191, 255, 0.05) 100%);
        }

        .pixel-card-cyan {
            border-color: #00FFFF;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(0, 255, 255, 0.05) 100%);
        }

        /* Thin border utility */
        .border-thin {
            border-width: 0.5px;
        }

        /* Hover glow effects */
        .glow-pink:hover {
            box-shadow: 0 0 20px rgba(255, 20, 147, 0.4);
        }

        .glow-blue:hover {
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.4);
        }

        .glow-cyan:hover {
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.4);
        }
    </style>

    <!-- Livewire Styles --><style >[wire\:loading][wire\:loading], [wire\:loading\.delay][wire\:loading\.delay], [wire\:loading\.inline-block][wire\:loading\.inline-block], [wire\:loading\.inline][wire\:loading\.inline], [wire\:loading\.block][wire\:loading\.block], [wire\:loading\.flex][wire\:loading\.flex], [wire\:loading\.table][wire\:loading\.table], [wire\:loading\.grid][wire\:loading\.grid], [wire\:loading\.inline-flex][wire\:loading\.inline-flex] {display: none;}[wire\:loading\.delay\.none][wire\:loading\.delay\.none], [wire\:loading\.delay\.shortest][wire\:loading\.delay\.shortest], [wire\:loading\.delay\.shorter][wire\:loading\.delay\.shorter], [wire\:loading\.delay\.short][wire\:loading\.delay\.short], [wire\:loading\.delay\.default][wire\:loading\.delay\.default], [wire\:loading\.delay\.long][wire\:loading\.delay\.long], [wire\:loading\.delay\.longer][wire\:loading\.delay\.longer], [wire\:loading\.delay\.longest][wire\:loading\.delay\.longest] {display: none;}[wire\:offline][wire\:offline] {display: none;}[wire\:dirty]:not(textarea):not(input):not(select) {display: none;}:root {--livewire-progress-bar-color: #2299dd;}[x-cloak] {display: none !important;}[wire\:cloak] {display: none !important;}</style>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body class="h-full bg-surface text-text-primary overflow-hidden">

    <!-- Livewire Component Root -->
<div wire:snapshot="{&quot;data&quot;:{&quot;input&quot;:&quot;&quot;,&quot;chatMessages&quot;:[[[{&quot;id&quot;:16,&quot;type&quot;:&quot;log&quot;,&quot;type_id&quot;:null,&quot;message&quot;:&quot;Let&#039;s do a new chat.&quot;,&quot;created_at&quot;:&quot;2025-09-21T03:28:16.000000Z&quot;},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:17,&quot;type&quot;:&quot;log&quot;,&quot;type_id&quot;:null,&quot;message&quot;:&quot;Pick up the cleaning&quot;,&quot;created_at&quot;:&quot;2025-09-21T03:28:31.000000Z&quot;},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:18,&quot;type&quot;:&quot;log&quot;,&quot;type_id&quot;:null,&quot;message&quot;:&quot;Call Dr. Conway about refill Tuesday @ 1pm&quot;,&quot;created_at&quot;:&quot;2025-09-21T03:28:44.000000Z&quot;},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:19,&quot;type&quot;:&quot;log&quot;,&quot;type_id&quot;:null,&quot;message&quot;:&quot;Fix slash commands breaking because of the new toast service provider&quot;,&quot;created_at&quot;:&quot;2025-09-21T03:30:03.000000Z&quot;},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:20,&quot;type&quot;:&quot;log&quot;,&quot;type_id&quot;:null,&quot;message&quot;:&quot;This is getting really good. UI seems to be the hardest part. A lot of regressions there. I&#039;ll fix that, need to refactor anyway.&quot;,&quot;created_at&quot;:&quot;2025-09-21T03:30:48.000000Z&quot;},{&quot;s&quot;:&quot;arr&quot;}]],{&quot;s&quot;:&quot;arr&quot;}],&quot;chatHistory&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;commandHistory&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;currentSession&quot;:null,&quot;recalledTodos&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;lastActivityAt&quot;:null,&quot;sessionTimeoutMinutes&quot;:60,&quot;currentChatSessionId&quot;:4,&quot;recentChatSessions&quot;:[[[{&quot;id&quot;:4,&quot;title&quot;:&quot;Let&#039;s do a new chat.&quot;,&quot;short_code&quot;:&quot;c4&quot;,&quot;channel_display&quot;:&quot;#c4 Let&#039;s do a new...&quot;,&quot;message_count&quot;:5,&quot;last_activity&quot;:&quot;6 days ago&quot;,&quot;preview&quot;:&quot;This is getting really good. UI seems to be the ha...&quot;},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:5,&quot;title&quot;:&quot;New Chat&quot;,&quot;short_code&quot;:&quot;c5&quot;,&quot;channel_display&quot;:&quot;#c5 New Chat&quot;,&quot;message_count&quot;:0,&quot;last_activity&quot;:&quot;6 days ago&quot;,&quot;preview&quot;:&quot;No messages&quot;},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:2,&quot;title&quot;:&quot;Test&quot;,&quot;short_code&quot;:&quot;c2&quot;,&quot;channel_display&quot;:&quot;#c2 Test&quot;,&quot;message_count&quot;:5,&quot;last_activity&quot;:&quot;6 days ago&quot;,&quot;preview&quot;:&quot;An h1 header\n============\n\nParagraphs are separate...&quot;},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:3,&quot;title&quot;:&quot;Test&quot;,&quot;short_code&quot;:&quot;c3&quot;,&quot;channel_display&quot;:&quot;#c3 Test&quot;,&quot;message_count&quot;:5,&quot;last_activity&quot;:&quot;6 days ago&quot;,&quot;preview&quot;:&quot;---\n__Advertisement :)__\n\n- __[pica](https:\/\/nodec...&quot;},{&quot;s&quot;:&quot;arr&quot;}]],{&quot;s&quot;:&quot;arr&quot;}],&quot;pinnedChatSessions&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;currentVaultId&quot;:1,&quot;currentProjectId&quot;:1,&quot;showRecallPalette&quot;:false,&quot;inCommandMode&quot;:false,&quot;originalFragments&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;recallQuery&quot;:&quot;&quot;,&quot;recallResults&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;recallSuggestions&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;recallAutocomplete&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;recallLoading&quot;:false,&quot;selectedRecallIndex&quot;:0,&quot;vaults&quot;:[[[{&quot;id&quot;:1,&quot;name&quot;:&quot;work&quot;,&quot;description&quot;:&quot;Work-related fragments and projects&quot;,&quot;is_default&quot;:false},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:2,&quot;name&quot;:&quot;personal&quot;,&quot;description&quot;:&quot;Personal thoughts, ideas, and tasks&quot;,&quot;is_default&quot;:false},{&quot;s&quot;:&quot;arr&quot;}],[{&quot;id&quot;:3,&quot;name&quot;:&quot;clients&quot;,&quot;description&quot;:&quot;Client communications and project materials&quot;,&quot;is_default&quot;:false},{&quot;s&quot;:&quot;arr&quot;}]],{&quot;s&quot;:&quot;arr&quot;}],&quot;projects&quot;:[[[{&quot;id&quot;:1,&quot;vault_id&quot;:1,&quot;name&quot;:&quot;Engineering&quot;,&quot;description&quot;:&quot;Software engineering tasks and documentation&quot;,&quot;is_default&quot;:true},{&quot;s&quot;:&quot;arr&quot;}]],{&quot;s&quot;:&quot;arr&quot;}],&quot;showVaultModal&quot;:false,&quot;showProjectModal&quot;:false,&quot;newVaultName&quot;:&quot;&quot;,&quot;newVaultDescription&quot;:&quot;&quot;,&quot;newProjectName&quot;:&quot;&quot;,&quot;newProjectDescription&quot;:&quot;&quot;,&quot;showToastSettings&quot;:false,&quot;mountedActions&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;defaultAction&quot;:null,&quot;defaultActionArguments&quot;:null,&quot;defaultActionContext&quot;:null,&quot;defaultTableAction&quot;:null,&quot;defaultTableActionRecord&quot;:null,&quot;defaultTableActionArguments&quot;:null,&quot;componentFileAttachments&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;areSchemaStateUpdateHooksDisabledForTesting&quot;:false,&quot;discoveredSchemaNames&quot;:[[],{&quot;s&quot;:&quot;arr&quot;}],&quot;parentRecord&quot;:null},&quot;memo&quot;:{&quot;id&quot;:&quot;WeGDkFNN1pt1U5i6byDA&quot;,&quot;name&quot;:&quot;app.filament.resources.fragment-resource.pages.chat-interface&quot;,&quot;path&quot;:&quot;fragments\/fragments\/lens&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;children&quot;:[],&quot;scripts&quot;:[],&quot;assets&quot;:[],&quot;errors&quot;:[],&quot;locale&quot;:&quot;en&quot;},&quot;checksum&quot;:&quot;d659776f8b0920ad18cf634519a745302b6f6ef11eca6bf82b6292968160b1ba&quot;}" wire:effects="{&quot;partials&quot;:[],&quot;url&quot;:{&quot;defaultAction&quot;:{&quot;as&quot;:&quot;action&quot;,&quot;use&quot;:&quot;replace&quot;,&quot;alwaysShow&quot;:false,&quot;except&quot;:null},&quot;defaultActionArguments&quot;:{&quot;as&quot;:&quot;actionArguments&quot;,&quot;use&quot;:&quot;replace&quot;,&quot;alwaysShow&quot;:false,&quot;except&quot;:null},&quot;defaultActionContext&quot;:{&quot;as&quot;:&quot;actionContext&quot;,&quot;use&quot;:&quot;replace&quot;,&quot;alwaysShow&quot;:false,&quot;except&quot;:null},&quot;defaultTableAction&quot;:{&quot;as&quot;:&quot;tableAction&quot;,&quot;use&quot;:&quot;replace&quot;,&quot;alwaysShow&quot;:false,&quot;except&quot;:null},&quot;defaultTableActionRecord&quot;:{&quot;as&quot;:&quot;tableActionRecord&quot;,&quot;use&quot;:&quot;replace&quot;,&quot;alwaysShow&quot;:false,&quot;except&quot;:null},&quot;defaultTableActionArguments&quot;:{&quot;as&quot;:&quot;tableActionArguments&quot;,&quot;use&quot;:&quot;replace&quot;,&quot;alwaysShow&quot;:false,&quot;except&quot;:null}},&quot;listeners&quot;:[&quot;echo:lens.chat,fragment.processed&quot;,&quot;undo-fragment&quot;,&quot;join-channel&quot;,&quot;refresh-page&quot;]}" wire:id="WeGDkFNN1pt1U5i6byDA">
    <!-- Main 4-Column Layout -->
    <div class="h-screen flex">

    <!-- Left Column 1: Ribbon -->
    <div class="w-16 bg-gray-900 border-r border-thin border-hot-pink/20 flex flex-col items-center py-4">
        <!-- Fe Periodic Element -->
        <div class="relative">
            <!-- Main hot pink square -->
            <div class="w-10 h-10 bg-hot-pink rounded-pixel flex items-center justify-center relative z-10 pixel-card glow-pink">
                <span class="text-white font-bold text-xl font-mono leading-none">Fe</span>
            </div>
            <!-- Offset outline -->
            <div class="absolute -top-0.5 -left-0.5 w-11 h-11 border-thin border-electric-blue rounded-pixel"></div>
        </div>

        <!-- Additional ribbon items -->
        <div class="mt-8 space-y-3">
            <!-- Create Flyout Menu -->
            <div x-data="{ open: false }" class="relative">
                <button
                    @click="open = !open"
                    class="w-8 h-8 bg-surface-card rounded-pixel pixel-card border-thin border-hot-pink/30 flex items-center justify-center hover:bg-hot-pink/10 transition-colors glow-pink"
                >
                    <svg class="w-4 h-4 text-hot-pink" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </button>

                <!-- Flyout Menu -->
                <div
                    x-show="open"
                    x-transition
                    x-cloak
                    @click.outside="open = false"
                    class="absolute left-full ml-2 top-0 bg-gray-900 border border-hot-pink/20 rounded-pixel p-2 space-y-1 min-w-48 z-50 shadow-lg shadow-hot-pink/10"
                >
                    <button
                        wire:click="openVaultModal"
                        @click="open = false"
                        class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-hot-pink/20 hover:text-hot-pink rounded-pixel transition-colors flex items-center space-x-2"
                    >
                        <svg class="w-4 h-4 text-hot-pink" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"/>
</svg>                        <span>New Vault</span>
                    </button>
                    <button
                        wire:click="openProjectModal"
                        @click="open = false"
                        class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-electric-blue/20 hover:text-electric-blue rounded-pixel transition-colors flex items-center space-x-2"
                    >
                        <svg class="w-4 h-4 text-electric-blue" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"/>
</svg>                        <span>New Project</span>
                    </button>
                    <button
                        wire:click="startNewChat"
                        @click="open = false"
                        class="w-full text-left px-3 py-2 text-sm text-gray-300 hover:bg-neon-cyan/20 hover:text-neon-cyan rounded-pixel transition-colors flex items-center space-x-2"
                    >
                        <svg class="w-4 h-4 text-neon-cyan" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"/>
</svg>                        <span>New Chat</span>
                    </button>
                </div>
            </div>

            <button class="w-8 h-8 bg-surface-card rounded-pixel pixel-card border-thin border-electric-blue/30 flex items-center justify-center hover:bg-electric-blue/10 transition-colors glow-blue">
                <svg class="w-4 h-4 text-electric-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
            </button>

            <!-- Toast Settings Button -->
            <div x-data="{ open: false }" class="relative">
                <button
                    @click="open = !open"
                    wire:click="toggleToastSettings"
                    class="w-8 h-8 bg-surface-card rounded-pixel pixel-card border-thin border-amber-500/30 flex items-center justify-center hover:bg-amber-500/10 transition-colors"
                    title="Toast notification settings"
                >
                    <svg class="w-4 h-4 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM9 12h6m-6-4h6m2 5l-8-5-8 5"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Left Column 2: Navigation -->
    <div class="w-72 bg-gray-900/95 border-r border-thin border-electric-blue/20 flex flex-col">
        <!-- Vault Selection -->
        <div class="p-4 border-b border-thin border-hot-pink/10">
            <div>
                <h3 class="text-xs font-medium text-hot-pink/80 mb-2">Vault</h3>
                <div class="flex space-x-1">
                    <select
                        wire:model.live="currentVaultId"
                        class="flex-1 bg-gray-800 text-sm text-hot-pink rounded-l-pixel p-2 border-thin border-hot-pink/20 focus:ring-1 focus:ring-hot-pink focus:border-hot-pink appearance-none cursor-pointer"
                        style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 20 20%27 fill=%27%23f97316%27%3e%3cpath fill-rule=%27evenodd%27 d=%27M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z%27 clip-rule=%27evenodd%27/%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem;"
                    >
                        <!--[if BLOCK]><![endif]-->                            <option value="1" selected class="bg-gray-800 text-gray-300">
                                work
                            </option>
                                                    <option value="2"  class="bg-gray-800 text-gray-300">
                                personal
                            </option>
                                                    <option value="3"  class="bg-gray-800 text-gray-300">
                                clients
                            </option>
                        <!--[if ENDBLOCK]><![endif]-->
                    </select>
                    <button
                        wire:click="openVaultModal"
                        class="px-3 bg-gray-800 border-thin border-hot-pink/20 rounded-r-pixel hover:bg-hot-pink/20 transition-colors text-hot-pink"
                        title="Create new vault"
                    >
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
</svg>                    </button>
                </div>
            </div>
        </div>

        <!-- Project Selection -->
        <div class="p-4 border-b border-thin border-electric-blue/10">
            <div>
                <h3 class="text-xs font-medium text-electric-blue/80 mb-2">Project</h3>
                <div class="flex space-x-1">
                    <select
                        wire:model.live="currentProjectId"
                        class="flex-1 bg-gray-800 text-sm text-electric-blue rounded-l-pixel p-2 border-thin border-electric-blue/20 focus:ring-1 focus:ring-electric-blue focus:border-electric-blue appearance-none cursor-pointer"
                        style="background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 20 20%27 fill=%27%2306b6d4%27%3e%3cpath fill-rule=%27evenodd%27 d=%27M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z%27 clip-rule=%27evenodd%27/%3e%3c/svg%3e'); background-repeat: no-repeat; background-position: right 0.5rem center; background-size: 1.5em 1.5em; padding-right: 2.5rem;"
                    >
                        <!--[if BLOCK]><![endif]-->                            <option value="1" selected class="bg-gray-800 text-gray-300">
                                Engineering
                            </option>
                        <!--[if ENDBLOCK]><![endif]-->
                    </select>
                    <button
                        wire:click="openProjectModal"
                        class="px-3 bg-gray-800 border-thin border-electric-blue/20 rounded-r-pixel hover:bg-electric-blue/20 transition-colors text-electric-blue"
                        title="Create new project"
                    >
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
</svg>                    </button>
                </div>
            </div>
        </div>

        <!-- Legacy Session Indicator -->
        <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->

        <!-- Chat History -->
        <div class="flex-1 p-4 overflow-y-auto">
            <!-- Pinned Chats -->
            <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->

            <!-- Recent Chats -->
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-xs font-medium text-electric-blue/80">
                    <svg class="inline w-3 h-3 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 0 1-.825-.242m9.345-8.334a2.126 2.126 0 0 0-.476-.095 48.64 48.64 0 0 0-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0 0 11.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"/>
</svg>                    Recent Chats
                </h3>
            </div>

            <div
                x-data="{
                    sortable: null,
                    initSortable() {
                        const container = document.getElementById('recent-chats-container');
                        if (container) {
                            this.sortable = Sortable.create(container, {
                                handle: '.drag-handle',
                                animation: 150,
                                ghostClass: 'opacity-50',
                                disabled: true, // Disable sorting but keep structure
                                onEnd: (evt) => {
                                    // No-op since sorting is disabled
                                }
                            });
                        }
                    }
                }"
                x-init="initSortable()"
                class="space-y-1"
                id="recent-chats-container"
            >
                <!--[if BLOCK]><![endif]-->                    <!--[if BLOCK]><![endif]-->                        <div
                            wire:click="switchToChat(4)"
                            class="flex items-center p-2 rounded-pixel cursor-pointer transition-all
                                bg-hot-pink/20 border-l-2 border-hot-pink"
                        >
                            <div class="flex-1 min-w-0 mr-2">
                                <span class="text-sm text-hot-pink truncate block" title="#c4 Let&#039;s do a new...">
                                    #c4 Let&#039;s do a new...
                                </span>
                            </div>
                            <span class="px-1.5 py-0.5 text-xs rounded-full bg-hot-pink/30 text-hot-pink font-medium">
                                5
                            </span>
                            <div class="flex items-center space-x-1 ml-2">
                                <button
                                    wire:click.stop="togglePinChat(4)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-electric-blue/20 hover:text-electric-blue hover:shadow-sm hover:shadow-electric-blue/20 transition-all"
                                    title="Pin chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"/>
</svg>                                </button>
                                <button
                                    wire:click.stop="deleteChat(4)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-hot-pink/20 hover:text-hot-pink hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                                    title="Delete chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                                </button>
                            </div>
                        </div>
                                            <div
                            wire:click="switchToChat(5)"
                            class="flex items-center p-2 rounded-pixel cursor-pointer transition-all
                                bg-gray-800 hover:bg-electric-blue/10"
                        >
                            <div class="flex-1 min-w-0 mr-2">
                                <span class="text-sm text-gray-300 truncate block" title="#c5 New Chat">
                                    #c5 New Chat
                                </span>
                            </div>
                            <span class="px-1.5 py-0.5 text-xs rounded-full bg-electric-blue/20 text-electric-blue font-medium">
                                0
                            </span>
                            <div class="flex items-center space-x-1 ml-2">
                                <button
                                    wire:click.stop="togglePinChat(5)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-electric-blue/20 hover:text-electric-blue hover:shadow-sm hover:shadow-electric-blue/20 transition-all"
                                    title="Pin chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"/>
</svg>                                </button>
                                <button
                                    wire:click.stop="deleteChat(5)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-hot-pink/20 hover:text-hot-pink hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                                    title="Delete chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                                </button>
                            </div>
                        </div>
                                            <div
                            wire:click="switchToChat(2)"
                            class="flex items-center p-2 rounded-pixel cursor-pointer transition-all
                                bg-gray-800 hover:bg-electric-blue/10"
                        >
                            <div class="flex-1 min-w-0 mr-2">
                                <span class="text-sm text-gray-300 truncate block" title="#c2 Test">
                                    #c2 Test
                                </span>
                            </div>
                            <span class="px-1.5 py-0.5 text-xs rounded-full bg-electric-blue/20 text-electric-blue font-medium">
                                5
                            </span>
                            <div class="flex items-center space-x-1 ml-2">
                                <button
                                    wire:click.stop="togglePinChat(2)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-electric-blue/20 hover:text-electric-blue hover:shadow-sm hover:shadow-electric-blue/20 transition-all"
                                    title="Pin chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"/>
</svg>                                </button>
                                <button
                                    wire:click.stop="deleteChat(2)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-hot-pink/20 hover:text-hot-pink hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                                    title="Delete chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                                </button>
                            </div>
                        </div>
                                            <div
                            wire:click="switchToChat(3)"
                            class="flex items-center p-2 rounded-pixel cursor-pointer transition-all
                                bg-gray-800 hover:bg-electric-blue/10"
                        >
                            <div class="flex-1 min-w-0 mr-2">
                                <span class="text-sm text-gray-300 truncate block" title="#c3 Test">
                                    #c3 Test
                                </span>
                            </div>
                            <span class="px-1.5 py-0.5 text-xs rounded-full bg-electric-blue/20 text-electric-blue font-medium">
                                5
                            </span>
                            <div class="flex items-center space-x-1 ml-2">
                                <button
                                    wire:click.stop="togglePinChat(3)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-electric-blue/20 hover:text-electric-blue hover:shadow-sm hover:shadow-electric-blue/20 transition-all"
                                    title="Pin chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"/>
</svg>                                </button>
                                <button
                                    wire:click.stop="deleteChat(3)"
                                    class="p-0.5 rounded bg-gray-700/50 text-gray-500 hover:bg-hot-pink/20 hover:text-hot-pink hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                                    title="Delete chat"
                                >
                                    <svg class="w-2.5 h-2.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                                </button>
                            </div>
                        </div>
                    <!--[if ENDBLOCK]><![endif]-->
                <!--[if ENDBLOCK]><![endif]-->
            </div>
        </div>

        <!-- New Chat & Commands -->
        <div class="p-4 border-t border-thin border-electric-blue/20 space-y-2">
            <button
                wire:click="startNewChat"
                class="w-full bg-electric-blue/20 hover:bg-electric-blue/30 text-electric-blue py-2 px-4 rounded-pixel transition-colors text-sm font-medium border border-electric-blue/40"
            >
                <svg class="inline w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
</svg>                New Chat
            </button>
            <button
                x-data
                x-on:click="$dispatch('open-command-palette')"
                class="w-full bg-hot-pink text-white py-2 px-4 rounded-pixel hover:bg-hot-pink/90 transition-colors text-sm font-medium"
            >
                <svg class="inline w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0 0 21 18V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v12a2.25 2.25 0 0 0 2.25 2.25Z"/>
</svg>                Commands
            </button>
        </div>
    </div>

    <!-- Middle Column: Chat Interface -->
    <div class="flex-1 flex flex-col bg-surface">
        <!-- Row 1: Header -->
        <div class="h-14 bg-gray-900/50 border-b border-thin border-hot-pink/20 flex items-center justify-between px-6 sticky top-0 z-10 backdrop-blur-sm">
            <!-- Left: Contact Card Style Layout -->
            <div class="flex items-center space-x-2">
                <div
                    id="drift-avatar"
                    x-data="{ avatar: '/interface/avatars/default/avatar-1.png' }"
                    x-init="$watch('avatar', value => {
        $el.querySelector('img').src = value;
      })"
                    class="w-12 h-12 bg-hot-pink/20 rounded-full shadow-lg border-2 border-electric-blue/30 transition-all"
                    style="box-shadow: 0 0 10px rgba(0, 212, 255, 0.4);"
                    x-cloak
                >
                    <img :src="avatar" alt="Holis Avatar" class="rounded-full w-full h-full object-cover">
                </div>
                <div class="flex items-center space-x-4">
                    <div>
                        <div class="flex items-center space-x-3">
                            <h2 class="text-base font-medium text-gray-300">Agent ID: </h2>
                            <span class="text-sm font-medium text-electric-blue/80">C1-13</span>

                            <span class="bg-electric-blue/20 text-electric-blue/80 text-xs px-2 py-0.5 rounded-full font-medium">v1.1.2</span>
                        </div>
                        <div class="text-xs font-medium text-gray-300">
                            <span>Role:</span>
                            <span class="text-hot-pink/80">Chat Assistant</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Search Input -->
            <div class="flex items-center space-x-4">
                <div class="relative" x-data="headerSearch()">
                    <div class="flex items-center">
                        <input
                            x-model="searchQuery"
                            x-on:focus="searchOpen = true; console.log('Header search: Input focused')"
                            x-on:blur="setTimeout(() => { if (!$refs.dropdown?.matches(':hover')) { searchOpen = false; console.log('Header search: Input blurred, closing dropdown'); } }, 200)"
                            x-on:input.debounce.300ms="handleSearch()"
                            placeholder="Search fragments..."
                            class="text-sm bg-gray-800 border border-gray-700 rounded-l-md px-3 py-2 text-text-primary placeholder-text-muted focus:outline-none focus:border-hot-pink w-64"
                        >
                        <div class="bg-hot-pink h-10 w-1 rounded-r-md flex items-center justify-center">
                            <svg class="w-4 h-4 text-gray-900" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/>
</svg>                        </div>
                    </div>

                    <!-- Search Dropdown -->
                    <div
                        x-ref="dropdown"
                        x-show="searchOpen && searchQuery.length > 0"
                        x-cloak
                        class="absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-hot-pink/30 rounded-md shadow-lg z-50 max-h-80 overflow-y-auto"
                        style="pointer-events: auto;"
                        x-on:mouseenter="console.log('Header search: Mouse entered dropdown')"
                        x-on:mouseleave="console.log('Header search: Mouse left dropdown')"
                    >
                        <div x-show="$wire.recallLoading" class="p-3 text-xs text-text-muted text-center">
                            <svg class="w-4 h-4 animate-spin inline mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"/>
</svg>                            Searching...
                        </div>

                        <div x-show="!$wire.recallLoading && $wire.recallResults.length === 0 && searchQuery.length >= 2" class="p-3 text-xs text-text-muted text-center">
                            No fragments found
                        </div>

                        <template x-for="(result, index) in $wire.recallResults" :key="result.id">
                            <div
                                class="p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0 transition-colors"
                                x-on:mousedown.prevent.stop="selectResult(index)"
                                x-on:click.prevent.stop="selectResult(index)"
                            >
                                <div class="flex items-start space-x-2">
                                    <!-- Type Badge -->
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium flex-shrink-0 mt-0.5"
                                        :class="{
                                            'bg-green-900/20 text-green-400 border border-green-500/20': result.type === 'todo' || result.type === 'task',
                                            'bg-purple-900/20 text-purple-400 border border-purple-500/20': result.type === 'meeting',
                                            'bg-yellow-900/20 text-yellow-400 border border-yellow-500/20': result.type === 'idea' || result.type === 'insight',
                                            'bg-gray-700 text-gray-300 border border-gray-500/20': result.type === 'note',
                                            'bg-blue-900/20 text-blue-400 border border-blue-500/20': !['todo', 'task', 'meeting', 'idea', 'insight', 'note'].includes(result.type)
                                        }"
                                        x-text="result.type">
                                    </span>

                                    <!-- Content -->
                                    <div class="flex-1 min-w-0">
                                        <div class="text-sm font-medium text-gray-200 truncate" x-text="result.title"></div>
                                        <div class="text-xs text-gray-400 line-clamp-2 mt-1">
                                            <template x-if="result.snippet">
                                                <span x-html="result.snippet"></span>
                                            </template>
                                            <template x-if="!result.snippet">
                                                <span x-text="result.preview"></span>
                                            </template>
                                        </div>

                                        <!-- Tags, Scores and Date -->
                                        <div class="flex items-center space-x-2 mt-2">
                                            <template x-if="result.tags && result.tags.length > 0">
                                                <div class="flex flex-wrap gap-1">
                                                    <template x-for="tag in result.tags.slice(0, 2)" :key="tag">
                                                        <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs bg-gray-700 text-gray-300" x-text="'#' + tag"></span>
                                                    </template>
                                                    <template x-if="result.tags.length > 2">
                                                        <span class="text-xs text-gray-400" x-text="'+' + (result.tags.length - 2)"></span>
                                                    </template>
                                                </div>
                                            </template>
                                            <template x-if="result.vec_sim > 0">
                                                <span class="text-xs text-electric-blue/60" :title="'Vector: ' + result.vec_sim.toFixed(3) + ' | Text: ' + result.txt_rank.toFixed(3)">
                                                    AI Match
                                                </span>
                                            </template>
                                            <div class="text-xs text-gray-400" x-text="result.created_at"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>

        <!-- Row 2: Chat Content -->
        <div class="flex-1 p-2 overflow-y-auto space-y-1 space-x-1" id="chat-output">
            <!-- Chat Messages -->
            <!--[if BLOCK]><![endif]-->                <!--[if BLOCK]><![endif]-->                    <div
     class="group py-3 px-4 transition-colors duration-200 rounded-md  bg-gray-900/60 hover:bg-gray-900/40 "
      data-fragment-id="16" >

    <div class="flex items-start justify-between">
        <div class="flex-1 mr-4">
            <div class="prose prose-sm dark:prose-invert max-w-none text-text-primary">
                <div class="prose dark:prose-invert w-full">
    <p>Let's do a new chat.</p>

</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center space-x-2">
            <!-- Copy & Delete Buttons - Only show on hover -->
            <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <!-- Copy Button -->
                <button
                    onclick="copyChatMessage(this)"
                    class="p-1.5 bg-gray-700 hover:bg-neon-cyan/20 text-gray-400 hover:text-neon-cyan rounded border border-gray-600 hover:border-neon-cyan/40 hover:shadow-sm hover:shadow-neon-cyan/20 transition-all"
                    title="Copy message"
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
</svg>                </button>

                <!--[if BLOCK]><![endif]-->                    <!-- Delete Button -->
                    <button
                        wire:click="deleteFragment(16)"
                        class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 text-gray-400 hover:text-hot-pink rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                        title="Delete message"
                        onclick="event.stopPropagation();"
                    >
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                    </button>
                <!--[if ENDBLOCK]><![endif]-->
            </div>

            <!--[if BLOCK]><![endif]-->                <!-- Bookmark Button - Independent visibility -->
                <button
                    onclick="toggleBookmark(16, this)"
                    class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all opacity-0 group-hover:opacity-100"
                    :class="bookmarked ? 'text-hot-pink border-hot-pink/40 !opacity-100' : 'text-gray-400 hover:text-hot-pink'"
                    title="Toggle bookmark"
                    data-fragment-id="16"
                    x-data="{ bookmarked: false }"
                    x-init="checkBookmarkStatus(16, $el)"
                    x-cloak
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"/>
</svg>                </button>
            <!--[if ENDBLOCK]><![endif]-->
        </div>
    </div>
</div>
                <!--[if ENDBLOCK]><![endif]-->
                            <!--[if BLOCK]><![endif]-->                    <div
     class="group py-3 px-4 transition-colors duration-200 rounded-md  bg-gray-900/60 hover:bg-gray-900/40 "
      data-fragment-id="17" >

    <div class="flex items-start justify-between">
        <div class="flex-1 mr-4">
            <div class="prose prose-sm dark:prose-invert max-w-none text-text-primary">
                <div class="prose dark:prose-invert w-full">
    <p>Pick up the cleaning</p>

</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center space-x-2">
            <!-- Copy & Delete Buttons - Only show on hover -->
            <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <!-- Copy Button -->
                <button
                    onclick="copyChatMessage(this)"
                    class="p-1.5 bg-gray-700 hover:bg-neon-cyan/20 text-gray-400 hover:text-neon-cyan rounded border border-gray-600 hover:border-neon-cyan/40 hover:shadow-sm hover:shadow-neon-cyan/20 transition-all"
                    title="Copy message"
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
</svg>                </button>

                <!--[if BLOCK]><![endif]-->                    <!-- Delete Button -->
                    <button
                        wire:click="deleteFragment(17)"
                        class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 text-gray-400 hover:text-hot-pink rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                        title="Delete message"
                        onclick="event.stopPropagation();"
                    >
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                    </button>
                <!--[if ENDBLOCK]><![endif]-->
            </div>

            <!--[if BLOCK]><![endif]-->                <!-- Bookmark Button - Independent visibility -->
                <button
                    onclick="toggleBookmark(17, this)"
                    class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all opacity-0 group-hover:opacity-100"
                    :class="bookmarked ? 'text-hot-pink border-hot-pink/40 !opacity-100' : 'text-gray-400 hover:text-hot-pink'"
                    title="Toggle bookmark"
                    data-fragment-id="17"
                    x-data="{ bookmarked: false }"
                    x-init="checkBookmarkStatus(17, $el)"
                    x-cloak
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"/>
</svg>                </button>
            <!--[if ENDBLOCK]><![endif]-->
        </div>
    </div>
</div>
                <!--[if ENDBLOCK]><![endif]-->
                            <!--[if BLOCK]><![endif]-->                    <div
     class="group py-3 px-4 transition-colors duration-200 rounded-md  bg-gray-900/60 hover:bg-gray-900/40 "
      data-fragment-id="18" >

    <div class="flex items-start justify-between">
        <div class="flex-1 mr-4">
            <div class="prose prose-sm dark:prose-invert max-w-none text-text-primary">
                <div class="prose dark:prose-invert w-full">
    <p>Call Dr. Conway about refill Tuesday @ 1pm</p>

</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center space-x-2">
            <!-- Copy & Delete Buttons - Only show on hover -->
            <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <!-- Copy Button -->
                <button
                    onclick="copyChatMessage(this)"
                    class="p-1.5 bg-gray-700 hover:bg-neon-cyan/20 text-gray-400 hover:text-neon-cyan rounded border border-gray-600 hover:border-neon-cyan/40 hover:shadow-sm hover:shadow-neon-cyan/20 transition-all"
                    title="Copy message"
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
</svg>                </button>

                <!--[if BLOCK]><![endif]-->                    <!-- Delete Button -->
                    <button
                        wire:click="deleteFragment(18)"
                        class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 text-gray-400 hover:text-hot-pink rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                        title="Delete message"
                        onclick="event.stopPropagation();"
                    >
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                    </button>
                <!--[if ENDBLOCK]><![endif]-->
            </div>

            <!--[if BLOCK]><![endif]-->                <!-- Bookmark Button - Independent visibility -->
                <button
                    onclick="toggleBookmark(18, this)"
                    class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all opacity-0 group-hover:opacity-100"
                    :class="bookmarked ? 'text-hot-pink border-hot-pink/40 !opacity-100' : 'text-gray-400 hover:text-hot-pink'"
                    title="Toggle bookmark"
                    data-fragment-id="18"
                    x-data="{ bookmarked: false }"
                    x-init="checkBookmarkStatus(18, $el)"
                    x-cloak
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"/>
</svg>                </button>
            <!--[if ENDBLOCK]><![endif]-->
        </div>
    </div>
</div>
                <!--[if ENDBLOCK]><![endif]-->
                            <!--[if BLOCK]><![endif]-->                    <div
     class="group py-3 px-4 transition-colors duration-200 rounded-md  bg-gray-900/60 hover:bg-gray-900/40 "
      data-fragment-id="19" >

    <div class="flex items-start justify-between">
        <div class="flex-1 mr-4">
            <div class="prose prose-sm dark:prose-invert max-w-none text-text-primary">
                <div class="prose dark:prose-invert w-full">
    <p>Fix slash commands breaking because of the new toast service provider</p>

</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center space-x-2">
            <!-- Copy & Delete Buttons - Only show on hover -->
            <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <!-- Copy Button -->
                <button
                    onclick="copyChatMessage(this)"
                    class="p-1.5 bg-gray-700 hover:bg-neon-cyan/20 text-gray-400 hover:text-neon-cyan rounded border border-gray-600 hover:border-neon-cyan/40 hover:shadow-sm hover:shadow-neon-cyan/20 transition-all"
                    title="Copy message"
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
</svg>                </button>

                <!--[if BLOCK]><![endif]-->                    <!-- Delete Button -->
                    <button
                        wire:click="deleteFragment(19)"
                        class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 text-gray-400 hover:text-hot-pink rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                        title="Delete message"
                        onclick="event.stopPropagation();"
                    >
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                    </button>
                <!--[if ENDBLOCK]><![endif]-->
            </div>

            <!--[if BLOCK]><![endif]-->                <!-- Bookmark Button - Independent visibility -->
                <button
                    onclick="toggleBookmark(19, this)"
                    class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all opacity-0 group-hover:opacity-100"
                    :class="bookmarked ? 'text-hot-pink border-hot-pink/40 !opacity-100' : 'text-gray-400 hover:text-hot-pink'"
                    title="Toggle bookmark"
                    data-fragment-id="19"
                    x-data="{ bookmarked: false }"
                    x-init="checkBookmarkStatus(19, $el)"
                    x-cloak
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"/>
</svg>                </button>
            <!--[if ENDBLOCK]><![endif]-->
        </div>
    </div>
</div>
                <!--[if ENDBLOCK]><![endif]-->
                            <!--[if BLOCK]><![endif]-->                    <div
     class="group py-3 px-4 transition-colors duration-200 rounded-md  bg-gray-900/60 hover:bg-gray-900/40 "
      data-fragment-id="20" >

    <div class="flex items-start justify-between">
        <div class="flex-1 mr-4">
            <div class="prose prose-sm dark:prose-invert max-w-none text-text-primary">
                <div class="prose dark:prose-invert w-full">
    <p>This is getting really good. UI seems to be the hardest part. A lot of regressions there. I'll fix that, need to refactor anyway.</p>

</div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex items-center space-x-2">
            <!-- Copy & Delete Buttons - Only show on hover -->
            <div class="flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                <!-- Copy Button -->
                <button
                    onclick="copyChatMessage(this)"
                    class="p-1.5 bg-gray-700 hover:bg-neon-cyan/20 text-gray-400 hover:text-neon-cyan rounded border border-gray-600 hover:border-neon-cyan/40 hover:shadow-sm hover:shadow-neon-cyan/20 transition-all"
                    title="Copy message"
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"/>
</svg>                </button>

                <!--[if BLOCK]><![endif]-->                    <!-- Delete Button -->
                    <button
                        wire:click="deleteFragment(20)"
                        class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 text-gray-400 hover:text-hot-pink rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all"
                        title="Delete message"
                        onclick="event.stopPropagation();"
                    >
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"/>
</svg>                    </button>
                <!--[if ENDBLOCK]><![endif]-->
            </div>

            <!--[if BLOCK]><![endif]-->                <!-- Bookmark Button - Independent visibility -->
                <button
                    onclick="toggleBookmark(20, this)"
                    class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all opacity-0 group-hover:opacity-100"
                    :class="bookmarked ? 'text-hot-pink border-hot-pink/40 !opacity-100' : 'text-gray-400 hover:text-hot-pink'"
                    title="Toggle bookmark"
                    data-fragment-id="20"
                    x-data="{ bookmarked: false }"
                    x-init="checkBookmarkStatus(20, $el)"
                    x-cloak
                >
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"/>
</svg>                </button>
            <!--[if ENDBLOCK]><![endif]-->
        </div>
    </div>
</div>
                <!--[if ENDBLOCK]><![endif]-->
            <!--[if ENDBLOCK]><![endif]-->

            <!-- Todos Section -->
            <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->
        </div>

        <!-- Undo Toast Row (slides up from below) -->
        <div
    x-data="{
        show: false,
        variant: 'info',
        title: '',
        message: '',
        actions: [],
        timeout: null,

        display(variant = 'info', title = '', message = '', actions = [], duration = 5) {
            this.variant = variant;
            this.title = title;
            this.message = message;
            this.actions = actions || [];
            this.show = true;

            if (this.timeout) {
                clearTimeout(this.timeout);
            }

            if (duration > 0) {
                this.timeout = setTimeout(() => {
                    this.hide();
                }, duration * 1000);
            }
        },

        hide() {
            this.show = false;
            if (this.timeout) {
                clearTimeout(this.timeout);
                this.timeout = null;
            }
        },

        getVariantClasses() {
            const variants = {
                'success': 'bg-emerald-900/90 border-emerald-500/50 text-emerald-100',
                'error': 'bg-rose-900/90 border-rose-500/50 text-rose-100',
                'warning': 'bg-amber-900/90 border-amber-500/50 text-amber-100',
                'info': 'bg-blue-900/90 border-blue-500/50 text-blue-100'
            };
            return variants[this.variant] || variants.info;
        },

        getIconClasses() {
            const icons = {
                'success': 'text-emerald-400',
                'error': 'text-rose-400',
                'warning': 'text-amber-400',
                'info': 'text-blue-400'
            };
            return icons[this.variant] || icons.info;
        },

        getIcon() {
            const icons = {
                'success': 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
                'error': 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z',
                'warning': 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z',
                'info': 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'
            };
            return icons[this.variant] || icons.info;
        }
    }"
    x-show="show"
    x-transition:enter="transition ease-out duration-300 transform"
    x-transition:enter-start="translate-y-full opacity-0"
    x-transition:enter-end="translate-y-0 opacity-100"
    x-transition:leave="transition ease-in duration-200 transform"
    x-transition:leave-start="translate-y-0 opacity-100"
    x-transition:leave-end="translate-y-full opacity-0"
    x-cloak
    id="undo-toast"
    class="fixed bottom-4 right-4 z-50 max-w-sm w-full"
>
    <div
        :class="getVariantClasses()"
        class="rounded-pixel border-2 backdrop-filter backdrop-blur-sm shadow-lg p-4 relative overflow-hidden"
    >
        <!-- Glow effect -->
        <div class="absolute inset-0 opacity-20 blur-sm" :class="getVariantClasses()"></div>

        <div class="relative z-10 flex items-start space-x-3">
            <!-- Icon -->
            <div class="flex-shrink-0">
                <svg
                    :class="getIconClasses()"
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        :d="getIcon()"
                    ></path>
                </svg>
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
                <p x-show="title" x-text="title" class="text-sm font-semibold"></p>
                <p x-text="message" class="text-sm" :class="title ? 'mt-1' : ''"></p>

                <!-- Actions -->
                <template x-if="actions && actions.length > 0">
                    <div class="mt-3 flex space-x-2">
                        <template x-for="(action, index) in actions" :key="index">
                            <button
                                @click="action.callback && action.callback(); hide();"
                                :class="action.primary ? 'bg-white/20 hover:bg-white/30' : 'hover:bg-white/10'"
                                class="text-xs px-3 py-1 rounded-pixel border border-current/30 transition-colors"
                                x-text="action.label"
                            ></button>
                        </template>
                    </div>
                </template>
            </div>

            <!-- Close button -->
            <button
                @click="hide()"
                class="flex-shrink-0 rounded-pixel p-1 hover:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-white/20"
                aria-label="Close notification"
            >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Keyboard support -->
        <div x-data @keydown.escape.window="hide()"></div>
    </div>
</div>
        <!-- Error Toast Row (slides up from below) -->
        <div
    x-data="{
        show: false,
        variant: 'error',
        title: '',
        message: '',
        actions: [],
        timeout: null,

        display(variant = 'info', title = '', message = '', actions = [], duration = 5) {
            this.variant = variant;
            this.title = title;
            this.message = message;
            this.actions = actions || [];
            this.show = true;

            if (this.timeout) {
                clearTimeout(this.timeout);
            }

            if (duration > 0) {
                this.timeout = setTimeout(() => {
                    this.hide();
                }, duration * 1000);
            }
        },

        hide() {
            this.show = false;
            if (this.timeout) {
                clearTimeout(this.timeout);
                this.timeout = null;
            }
        },

        getVariantClasses() {
            const variants = {
                'success': 'bg-emerald-900/90 border-emerald-500/50 text-emerald-100',
                'error': 'bg-rose-900/90 border-rose-500/50 text-rose-100',
                'warning': 'bg-amber-900/90 border-amber-500/50 text-amber-100',
                'info': 'bg-blue-900/90 border-blue-500/50 text-blue-100'
            };
            return variants[this.variant] || variants.info;
        },

        getIconClasses() {
            const icons = {
                'success': 'text-emerald-400',
                'error': 'text-rose-400',
                'warning': 'text-amber-400',
                'info': 'text-blue-400'
            };
            return icons[this.variant] || icons.info;
        },

        getIcon() {
            const icons = {
                'success': 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
                'error': 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z',
                'warning': 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z',
                'info': 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'
            };
            return icons[this.variant] || icons.info;
        }
    }"
    x-show="show"
    x-transition:enter="transition ease-out duration-300 transform"
    x-transition:enter-start="translate-y-full opacity-0"
    x-transition:enter-end="translate-y-0 opacity-100"
    x-transition:leave="transition ease-in duration-200 transform"
    x-transition:leave-start="translate-y-0 opacity-100"
    x-transition:leave-end="translate-y-full opacity-0"
    x-cloak
    id="error-toast"
    class="fixed bottom-4 right-4 z-50 max-w-sm w-full"
>
    <div
        :class="getVariantClasses()"
        class="rounded-pixel border-2 backdrop-filter backdrop-blur-sm shadow-lg p-4 relative overflow-hidden"
    >
        <!-- Glow effect -->
        <div class="absolute inset-0 opacity-20 blur-sm" :class="getVariantClasses()"></div>

        <div class="relative z-10 flex items-start space-x-3">
            <!-- Icon -->
            <div class="flex-shrink-0">
                <svg
                    :class="getIconClasses()"
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        :d="getIcon()"
                    ></path>
                </svg>
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
                <p x-show="title" x-text="title" class="text-sm font-semibold"></p>
                <p x-text="message" class="text-sm" :class="title ? 'mt-1' : ''"></p>

                <!-- Actions -->
                <template x-if="actions && actions.length > 0">
                    <div class="mt-3 flex space-x-2">
                        <template x-for="(action, index) in actions" :key="index">
                            <button
                                @click="action.callback && action.callback(); hide();"
                                :class="action.primary ? 'bg-white/20 hover:bg-white/30' : 'hover:bg-white/10'"
                                class="text-xs px-3 py-1 rounded-pixel border border-current/30 transition-colors"
                                x-text="action.label"
                            ></button>
                        </template>
                    </div>
                </template>
            </div>

            <!-- Close button -->
            <button
                @click="hide()"
                class="flex-shrink-0 rounded-pixel p-1 hover:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-white/20"
                aria-label="Close notification"
            >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Keyboard support -->
        <div x-data @keydown.escape.window="hide()"></div>
    </div>
</div>
        <!-- Success Toast Row (slides up from below) -->
        <div
    x-data="{
        show: false,
        variant: 'success',
        title: '',
        message: '',
        actions: [],
        timeout: null,

        display(variant = 'info', title = '', message = '', actions = [], duration = 5) {
            this.variant = variant;
            this.title = title;
            this.message = message;
            this.actions = actions || [];
            this.show = true;

            if (this.timeout) {
                clearTimeout(this.timeout);
            }

            if (duration > 0) {
                this.timeout = setTimeout(() => {
                    this.hide();
                }, duration * 1000);
            }
        },

        hide() {
            this.show = false;
            if (this.timeout) {
                clearTimeout(this.timeout);
                this.timeout = null;
            }
        },

        getVariantClasses() {
            const variants = {
                'success': 'bg-emerald-900/90 border-emerald-500/50 text-emerald-100',
                'error': 'bg-rose-900/90 border-rose-500/50 text-rose-100',
                'warning': 'bg-amber-900/90 border-amber-500/50 text-amber-100',
                'info': 'bg-blue-900/90 border-blue-500/50 text-blue-100'
            };
            return variants[this.variant] || variants.info;
        },

        getIconClasses() {
            const icons = {
                'success': 'text-emerald-400',
                'error': 'text-rose-400',
                'warning': 'text-amber-400',
                'info': 'text-blue-400'
            };
            return icons[this.variant] || icons.info;
        },

        getIcon() {
            const icons = {
                'success': 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
                'error': 'M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z',
                'warning': 'M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z',
                'info': 'M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z'
            };
            return icons[this.variant] || icons.info;
        }
    }"
    x-show="show"
    x-transition:enter="transition ease-out duration-300 transform"
    x-transition:enter-start="translate-y-full opacity-0"
    x-transition:enter-end="translate-y-0 opacity-100"
    x-transition:leave="transition ease-in duration-200 transform"
    x-transition:leave-start="translate-y-0 opacity-100"
    x-transition:leave-end="translate-y-full opacity-0"
    x-cloak
    id="success-toast"
    class="fixed bottom-4 right-4 z-50 max-w-sm w-full"
>
    <div
        :class="getVariantClasses()"
        class="rounded-pixel border-2 backdrop-filter backdrop-blur-sm shadow-lg p-4 relative overflow-hidden"
    >
        <!-- Glow effect -->
        <div class="absolute inset-0 opacity-20 blur-sm" :class="getVariantClasses()"></div>

        <div class="relative z-10 flex items-start space-x-3">
            <!-- Icon -->
            <div class="flex-shrink-0">
                <svg
                    :class="getIconClasses()"
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        :d="getIcon()"
                    ></path>
                </svg>
            </div>

            <!-- Content -->
            <div class="flex-1 min-w-0">
                <p x-show="title" x-text="title" class="text-sm font-semibold"></p>
                <p x-text="message" class="text-sm" :class="title ? 'mt-1' : ''"></p>

                <!-- Actions -->
                <template x-if="actions && actions.length > 0">
                    <div class="mt-3 flex space-x-2">
                        <template x-for="(action, index) in actions" :key="index">
                            <button
                                @click="action.callback && action.callback(); hide();"
                                :class="action.primary ? 'bg-white/20 hover:bg-white/30' : 'hover:bg-white/10'"
                                class="text-xs px-3 py-1 rounded-pixel border border-current/30 transition-colors"
                                x-text="action.label"
                            ></button>
                        </template>
                    </div>
                </template>
            </div>

            <!-- Close button -->
            <button
                @click="hide()"
                class="flex-shrink-0 rounded-pixel p-1 hover:bg-white/10 transition-colors focus:outline-none focus:ring-2 focus:ring-white/20"
                aria-label="Close notification"
            >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Keyboard support -->
        <div x-data @keydown.escape.window="hide()"></div>
    </div>
</div>
        <!-- Row 3: Input Area -->
        <div class="bg-surface-2 border-t border-thin border-hot-pink/30">
            <!-- Chat Input -->
            <form id="chat-form" x-data wire:submit.prevent="handleInput" class="p-4">
                <div class="flex space-x-3">
                    <div class="flex-1">
                        <textarea
                            x-data="chatTextarea()"
                            x-ref="chatTextarea"
                            x-init="initAutocomplete()"
                            wire:model.defer="input"
                            x-on:keydown.enter.prevent="handleEnterKey($event)"
                            class="w-full p-3 border-thin border-hot-pink/30 rounded-pixel resize-none focus:ring-2 focus:ring-hot-pink focus:border-hot-pink pixel-card bg-surface-card text-text-primary"
                            rows="2"
                            placeholder="Type your message... (try /, @, or [[)"
                        ></textarea>
                    </div>
                    <button type="submit" class="px-4 py-2 bg-hot-pink text-white rounded-pixel hover:bg-hot-pink/90 transition-colors self-center pixel-card glow-pink">
                        Send
                    </button>
                </div>

                <!-- Command History -->
                <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->
            </form>
        </div>
    </div>

    <!-- Right Column: Widgets & Search -->
    <div class="w-80 bg-gray-900/95 border-l border-thin border-electric-blue/20 flex flex-col">
        <!-- Widgets Section -->
        <div class="flex-1 p-4 overflow-y-auto">

            <!-- System Widgets -->
            <div class="space-y-4 mb-6">
                <!-- Stats Widget -->
                <div class="bg-gray-800 rounded-pixel p-3 border border-hot-pink/20">
                    <h4 class="text-xs font-medium text-hot-pink mb-2">Today's Activity</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-text-muted">Messages</span>
                            <span class="text-sm font-medium text-hot-pink">5</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-text-muted">Commands</span>
                            <span class="text-sm font-medium text-electric-blue">0</span>
                        </div>
                        <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->
                    </div>
                </div>


                <!-- Recent Bookmarks Widget -->
                <div
                    class="bg-gray-800 rounded-pixel p-3 border border-neon-cyan/20"
                    x-data="bookmarkWidget()"
                    x-init="init(); loadRecentBookmarks()"
                    x-cloak
                >
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-xs font-medium text-neon-cyan">Recent Bookmarks</h4>
                        <button
                            x-show="!searchMode"
                            x-cloak
                            x-on:click="searchMode = true; $nextTick(() => $refs.searchInput.focus())"
                            class="text-xs text-text-muted hover:text-neon-cyan transition-colors"
                        >
                            <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"/>
</svg>                        </button>
                        <button
                            x-show="searchMode"
                            x-cloak
                            x-on:click="clearSearch()"
                            class="text-xs text-text-muted hover:text-neon-cyan transition-colors"
                        >
                            <svg class="w-3 h-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
</svg>                        </button>
                    </div>

                    <!-- Search Input -->
                    <div x-show="searchMode" x-cloak class="mb-3">
                        <input
                            x-ref="searchInput"
                            x-model="searchQuery"
                            x-on:input.debounce.300ms="handleSearch()"
                            placeholder="Search bookmarks..."
                            class="w-full bg-surface-card text-text-secondary text-xs p-2 rounded-pixel border-thin border-neon-cyan/40 focus:border-neon-cyan focus:outline-none"
                        />
                    </div>

                    <!-- Bookmarks List -->
                    <div class="space-y-2 max-h-48 overflow-y-auto" x-show="!loading" :class="{ 'pointer-events-none': openingModal }">
                        <template x-for="bookmark in bookmarks" :key="bookmark.id">
                            <div
                                x-on:click.stop="openBookmark(bookmark)"
                                class="flex items-center space-x-2 text-xs cursor-pointer hover:bg-neon-cyan/10 p-1 rounded-pixel transition-colors"
                            >
                                <svg class="w-3 h-3 text-hot-pink flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"/>
</svg>                                <span
                                    class="text-text-secondary flex-1 truncate"
                                    :title="bookmark.fragment_title"
                                    x-text="bookmark.name"
                                ></span>
                                <span class="text-text-muted text-xs flex-shrink-0" x-text="bookmark.updated_at"></span>
                            </div>
                        </template>

                        <!-- Empty State -->
                        <div x-show="bookmarks.length === 0 && !loading" class="text-center text-text-muted text-xs py-4">
                            <span x-show="!searchMode">No bookmarks yet</span>
                            <span x-show="searchMode">No results found</span>
                        </div>
                    </div>

                    <!-- Loading State -->
                    <div x-show="loading" class="text-center text-neon-cyan text-xs py-4">
                        ⏳ Loading...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Autocomplete Scripts -->
    <link rel="preload" as="style" href="https://seer.test/build/assets/app-CIqgeAyb.css" /><link rel="modulepreload" as="script" href="https://seer.test/build/assets/app-22OXdLpX.js" /><link rel="stylesheet" href="https://seer.test/build/assets/app-CIqgeAyb.css" data-navigate-track="reload" /><script type="module" src="https://seer.test/build/assets/app-22OXdLpX.js" data-navigate-track="reload"></script>    <script>
        function bookmarkWidget() {
            return {
                bookmarks: [],
                loading: false,
                searchMode: false,
                searchQuery: '',
                openingModal: false,

                init() {
                    // Listen for modal close events to reset our state
                    document.addEventListener('modalClosed', () => {
                        this.openingModal = false;
                    });

                    // Listen for fragment deletion events
                    window.addEventListener('show-undo-toast', () => {
                        this.loadRecentBookmarks();
                    });

                    // Listen for fragment restoration events
                    Livewire.on('undo-fragment', () => {
                        setTimeout(() => this.loadRecentBookmarks(), 100);
                    });

                    // Listen for bookmark toggle events
                    window.addEventListener('bookmark-toggled', () => {
                        this.loadRecentBookmarks();
                    });

                    // Listen for fragment restoration events
                    window.addEventListener('fragment-restored', () => {
                        this.loadRecentBookmarks();
                    });
                },

                async loadRecentBookmarks() {
                    this.loading = true;
                    try {
                        const response = await fetch('/api/bookmarks/recent?limit=6');
                        if (response.ok) {
                            const data = await response.json();
                            this.bookmarks = data.bookmarks;
                        } else if (response.status !== 404) {
                            console.warn('Failed to load recent bookmarks:', response.status);
                        }
                    } catch (error) {
                        console.log('Failed to load recent bookmarks (this is normal for new systems):', error.message);
                    } finally {
                        this.loading = false;
                    }
                },

                async handleSearch() {
                    if (this.searchQuery.length < 2) {
                        await this.loadRecentBookmarks();
                        return;
                    }

                    this.loading = true;
                    try {
                        const response = await fetch(`/api/bookmarks/search?q=${encodeURIComponent(this.searchQuery)}&limit=8`);
                        if (response.ok) {
                            const data = await response.json();
                            this.bookmarks = data.bookmarks;
                        } else if (response.status !== 404) {
                            console.warn('Failed to search bookmarks:', response.status);
                        }
                    } catch (error) {
                        console.log('Failed to search bookmarks (this is normal for new systems):', error.message);
                    } finally {
                        this.loading = false;
                    }
                },

                clearSearch() {
                    this.searchMode = false;
                    this.searchQuery = '';
                    this.loadRecentBookmarks();
                },

                async openBookmark(bookmark) {
                    console.log('Opening bookmark:', bookmark);

                    // Prevent multiple simultaneous openings
                    if (this.openingModal) {
                        console.log('Modal already opening, ignoring click');
                        return;
                    }

                    if (!bookmark || !bookmark.fragment_id) {
                        console.warn('No fragment ID for bookmark:', bookmark);
                        alert('This bookmark references a fragment that no longer exists.');
                        return;
                    }

                    this.openingModal = true;

                    // Mark bookmark as viewed
                    try {
                        const response = await fetch(`/api/bookmarks/${bookmark.id}/mark-viewed`, {
                            method: 'POST',
                            headers: {
                                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                            }
                        });
                        if (!response.ok) {
                            console.warn('Failed to mark bookmark as viewed:', response.status);
                        }
                    } catch (error) {
                        console.error('Failed to mark bookmark as viewed:', error);
                    }

                    // Create modal directly using the same pattern as header search
                    try {
                        console.log('Bookmark widget: Opening fragment modal for ID:', bookmark.fragment_id);

                        // Fetch fragment data
                        const response = await fetch(`/api/fragments/${bookmark.fragment_id}`);
                        if (!response.ok) {
                            throw new Error(`Failed to load fragment: HTTP ${response.status}`);
                        }

                        const fragmentData = await response.json();
                        console.log('Bookmark widget: Fragment data loaded:', fragmentData);

                        // Show the fragment using direct modal creation (same as header search)
                        this.showFragmentInModal(fragmentData);

                    } catch (error) {
                        console.error('Bookmark widget: Failed to load fragment:', error);
                        alert('Failed to load bookmark: ' + error.message);
                    } finally {
                        // Reset the flag after a delay to prevent accidental rapid clicks
                        setTimeout(() => {
                            this.openingModal = false;
                        }, 300);
                    }
                },

                showFragmentInModal(fragmentData) {
                    // Create or get modal container
                    let modalContainer = document.getElementById('bookmark-result-modal');
                    if (!modalContainer) {
                        modalContainer = document.createElement('div');
                        modalContainer.id = 'bookmark-result-modal';
                        modalContainer.className = 'fixed inset-0 z-50 hidden';
                        document.body.appendChild(modalContainer);
                    }

                    const fragmentType = fragmentData.type || 'unknown';

                    modalContainer.innerHTML = `
                        <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="document.getElementById('bookmark-result-modal').classList.add('hidden'); document.body.style.overflow = 'auto';"></div>
                        <div class="fixed inset-0 flex items-center justify-center p-4">
                            <div class="relative max-w-4xl max-h-[90vh] overflow-auto bg-surface-2 p-6 rounded-pixel border border-thin border-hot-pink/30" style="min-width: 750px;">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center space-x-3">
                                        <h2 class="text-lg font-medium text-text-primary">Fragment #${fragmentData.id}</h2>
                                        <span class="text-xs bg-hot-pink/20 text-hot-pink px-2 py-1 rounded-pixel border border-hot-pink/40">${fragmentType.toUpperCase()}</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button onclick="window.copyFragmentFromModal(event, '${this.escapeHtml(fragmentData.message)}')" class="p-1.5 bg-gray-700 hover:bg-neon-cyan/20 text-gray-400 hover:text-neon-cyan rounded border border-gray-600 hover:border-neon-cyan/40 hover:shadow-sm hover:shadow-neon-cyan/20 transition-all" title="Copy fragment">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                            </svg>
                                        </button>
                                        <button onclick="document.getElementById('bookmark-result-modal').classList.add('hidden'); document.body.style.overflow = 'auto';" class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 text-gray-400 hover:text-hot-pink rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all" title="Close">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="space-y-4">
                                    <div class="bg-surface-elevated p-4 rounded-pixel">
                                        <div class="text-sm text-text-primary whitespace-pre-wrap">${this.escapeHtml(fragmentData.message)}</div>
                                    </div>

                                    <div class="flex justify-between text-xs text-text-muted">
                                        <span>Created: ${new Date(fragmentData.created_at).toLocaleDateString()}</span>
                                        <span>ID: ${fragmentData.id}</span>
                                    </div>

                                    ${fragmentData.tags && fragmentData.tags.length ? `
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="text-text-muted">Tags:</span>
                                            ${fragmentData.tags.map(tag => `
                                                <span class="bg-electric-blue/20 text-electric-blue px-2 py-0.5 rounded border border-electric-blue/40">${tag}</span>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;

                    // Show the modal
                    modalContainer.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';

                    // Add ESC key handler
                    const escHandler = (e) => {
                        if (e.key === 'Escape') {
                            modalContainer.classList.add('hidden');
                            document.body.style.overflow = 'auto';
                            document.removeEventListener('keydown', escHandler);
                        }
                    };
                    document.addEventListener('keydown', escHandler);
                },

                escapeHtml(text) {
                    const map = {
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;',
                        "'": '&#039;'
                    };
                    return text.replace(/[&<>"']/g, m => map[m]);
                }
            };
        }

        function headerSearch() {
            return {
                searchOpen: false,
                searchQuery: '',
                openingModal: false,

                handleSearch() {
                    console.log('Header search: handleSearch called with query:', this.searchQuery);

                    if (this.searchQuery.length < 2) {
                        console.log('Header search: Query too short, clearing results');
                        this.$wire.set('recallResults', []);
                        return;
                    }

                    console.log('Header search: Setting recallQuery and calling performRecallSearch');
                    // Use existing recall search functionality
                    this.$wire.set('recallQuery', this.searchQuery);
                    this.$wire.call('performRecallSearch').then(() => {
                        console.log('Header search: performRecallSearch completed, results:', this.$wire.recallResults);
                    }).catch(error => {
                        console.error('Header search: performRecallSearch failed:', error);
                    });
                },

                async selectResult(index) {
                    console.log('Header search: selectResult called with index:', index);
                    console.log('Header search: recallResults:', this.$wire.recallResults);

                    const result = this.$wire.recallResults[index];
                    console.log('Header search: selected result:', result);

                    if (!result || !result.id) {
                        console.warn('Header search: No fragment ID for result:', result);
                        return;
                    }

                    // Prevent multiple simultaneous openings
                    if (this.openingModal) {
                        console.log('Header search: Modal already opening, ignoring click');
                        return;
                    }

                    this.openingModal = true;
                    this.searchOpen = false;
                    this.searchQuery = '';

                    // Simple direct approach - just open the modal with the fragment ID
                    try {
                        console.log('Header search: Opening fragment modal for ID:', result.id);

                        // Create a simple modal directly without waiting for LinkHandler
                        const response = await fetch(`/api/fragments/${result.id}`);
                        if (!response.ok) {
                            throw new Error(`Failed to load fragment: HTTP ${response.status}`);
                        }

                        const fragmentData = await response.json();
                        console.log('Header search: Fragment data loaded:', fragmentData);

                        // Show the fragment using a simple modal
                        this.showFragmentInModal(fragmentData);

                    } catch (error) {
                        console.error('Header search: Failed to load fragment:', error);
                        alert('Failed to load fragment: ' + error.message);
                    } finally {
                        // Reset the flag after a delay
                        setTimeout(() => {
                            this.openingModal = false;
                        }, 500);
                    }
                },

                showFragmentInModal(fragmentData) {
                    // Create or get modal container
                    let modalContainer = document.getElementById('search-result-modal');
                    if (!modalContainer) {
                        modalContainer = document.createElement('div');
                        modalContainer.id = 'search-result-modal';
                        modalContainer.className = 'fixed inset-0 z-50 hidden';
                        document.body.appendChild(modalContainer);
                    }

                    const fragmentType = fragmentData.type || 'unknown';

                    modalContainer.innerHTML = `
                        <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm" onclick="document.getElementById('search-result-modal').classList.add('hidden')"></div>
                        <div class="fixed inset-0 flex items-center justify-center p-4">
                            <div class="relative max-w-4xl max-h-[90vh] overflow-auto bg-surface-2 p-6 rounded-pixel border border-thin border-hot-pink/30" style="min-width: 750px;">
                                <div class="flex items-center justify-between mb-4">
                                    <div class="flex items-center space-x-3">
                                        <h2 class="text-lg font-medium text-text-primary">Fragment #${fragmentData.id}</h2>
                                        <span class="text-xs bg-hot-pink/20 text-hot-pink px-2 py-1 rounded-pixel border border-hot-pink/40">${fragmentType.toUpperCase()}</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button onclick="window.copyFragmentFromModal(event, '${this.escapeHtml(fragmentData.message)}')" class="p-1.5 bg-gray-700 hover:bg-neon-cyan/20 text-gray-400 hover:text-neon-cyan rounded border border-gray-600 hover:border-neon-cyan/40 hover:shadow-sm hover:shadow-neon-cyan/20 transition-all" title="Copy fragment">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                            </svg>
                                        </button>
                                        <button onclick="document.getElementById('search-result-modal').classList.add('hidden'); document.body.style.overflow = 'auto';" class="p-1.5 bg-gray-700 hover:bg-hot-pink/20 text-gray-400 hover:text-hot-pink rounded border border-gray-600 hover:border-hot-pink/40 hover:shadow-sm hover:shadow-hot-pink/20 transition-all" title="Close">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="space-y-4">
                                    <div class="bg-surface-elevated p-4 rounded-pixel">
                                        <div class="text-sm text-text-primary whitespace-pre-wrap">${this.escapeHtml(fragmentData.message)}</div>
                                    </div>

                                    <div class="flex justify-between text-xs text-text-muted">
                                        <span>Created: ${new Date(fragmentData.created_at).toLocaleDateString()}</span>
                                        <span>ID: ${fragmentData.id}</span>
                                    </div>

                                    ${fragmentData.tags && fragmentData.tags.length ? `
                                        <div class="flex items-center gap-2 text-xs">
                                            <span class="text-text-muted">Tags:</span>
                                            ${fragmentData.tags.map(tag => `
                                                <span class="bg-electric-blue/20 text-electric-blue px-2 py-0.5 rounded border border-electric-blue/40">${tag}</span>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;

                    modalContainer.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';

                    // Close modal on escape key
                    const escapeHandler = (e) => {
                        if (e.key === 'Escape') {
                            modalContainer.classList.add('hidden');
                            document.body.style.overflow = 'auto';
                            document.removeEventListener('keydown', escapeHandler);
                        }
                    };
                    document.addEventListener('keydown', escapeHandler);
                },

                escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }
            };
        }

        // Global function for copying fragment content from modal
        window.copyFragmentFromModal = async function(event, text) {
            try {
                // Unescape HTML entities
                const textarea = document.createElement('textarea');
                textarea.innerHTML = text;
                const unescapedText = textarea.value;

                // Copy to clipboard
                await navigator.clipboard.writeText(unescapedText);

                // Visual feedback on the button
                const button = event.target.closest('button');
                if (button) {
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                    button.classList.add('text-green-400', 'border-green-400/40');
                    button.classList.remove('text-gray-400', 'border-gray-600');

                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.classList.remove('text-green-400', 'border-green-400/40');
                        button.classList.add('text-gray-400', 'border-gray-600');
                    }, 2000);
                }
            } catch (error) {
                console.error('Failed to copy fragment:', error);

                // Error feedback
                const button = event.target.closest('button');
                if (button) {
                    const originalHTML = button.innerHTML;
                    button.innerHTML = '<svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>';
                    button.classList.add('text-red-400', 'border-red-400/40');

                    setTimeout(() => {
                        button.innerHTML = originalHTML;
                        button.classList.remove('text-red-400', 'border-red-400/40');
                    }, 2000);
                }
            }
        }

        function chatTextarea() {
            return {
                autocompleteActive: false,
                autocompleteEngine: null,

                initAutocomplete() {
                    if (typeof AutocompleteEngine !== 'undefined') {
                        this.autocompleteEngine = new AutocompleteEngine(this.$refs.chatTextarea);

                        // Monitor autocomplete state
                        const originalShow = this.autocompleteEngine.show.bind(this.autocompleteEngine);
                        const originalHide = this.autocompleteEngine.hide.bind(this.autocompleteEngine);

                        this.autocompleteEngine.show = () => {
                            // Don't show autocomplete if in command mode
                            if (this.$wire.inCommandMode) {
                                return;
                            }
                            this.autocompleteActive = true;
                            originalShow();
                        };

                        this.autocompleteEngine.hide = () => {
                            this.autocompleteActive = false;
                            originalHide();
                        };

                        // Watch for command mode changes
                        this.$watch('$wire.inCommandMode', (isInCommandMode) => {
                            if (isInCommandMode && this.autocompleteActive) {
                                this.autocompleteEngine.hide();
                            }
                        });
                    }
                },

                handleEnterKey(event) {
                    // If autocomplete is active, don't submit
                    if (this.autocompleteActive) {
                        return;
                    }

                    // Don't clear the textarea here - let Livewire handle it
                    // Just trigger the form submission
                    this.$nextTick(() => {
                        const form = document.getElementById('chat-form');
                        if (form) {
                            form.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
                        }
                    });
                },

                destroy() {
                    if (this.autocompleteEngine) {
                        this.autocompleteEngine.destroy();
                    }
                }
            };
        }
    </script>

    <!-- Command Palette Modal -->
    <div
        x-data="{ open: false }"
        x-on:open-command-palette.window="open = true"
        x-show="open"
        style="display: none;"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
    >
        <div class="bg-gray-900 rounded-pixel p-6 w-96 shadow-xl border border-electric-blue/30">
            <h3 class="text-lg font-semibold mb-4 text-center text-electric-blue">
                <svg class="inline w-5 h-5 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m6.75 7.5 3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0 0 21 18V6a2.25 2.25 0 0 0-2.25-2.25H5.25A2.25 2.25 0 0 0 3 6v12a2.25 2.25 0 0 0 2.25 2.25Z"/>
</svg>                Command Palette
            </h3>
            <div class="space-y-2">
                <!--[if BLOCK]><![endif]-->                    <button
                        wire:click="executeCommand('session')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /session
                    </button>
                                    <button
                        wire:click="executeCommand('recall')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /recall
                    </button>
                                    <button
                        wire:click="executeCommand('bookmark')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /bookmark
                    </button>
                                    <button
                        wire:click="executeCommand('help')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /help
                    </button>
                                    <button
                        wire:click="executeCommand('clear')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /clear
                    </button>
                                    <button
                        wire:click="executeCommand('frag')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /frag
                    </button>
                                    <button
                        wire:click="executeCommand('chaos')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /chaos
                    </button>
                                    <button
                        wire:click="executeCommand('search')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /search
                    </button>
                                    <button
                        wire:click="executeCommand('s')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /s
                    </button>
                                    <button
                        wire:click="executeCommand('todo')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /todo
                    </button>
                                    <button
                        wire:click="executeCommand('t')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /t
                    </button>
                                    <button
                        wire:click="executeCommand('join')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /join
                    </button>
                                    <button
                        wire:click="executeCommand('j')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /j
                    </button>
                                    <button
                        wire:click="executeCommand('channels')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /channels
                    </button>
                                    <button
                        wire:click="executeCommand('name')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /name
                    </button>
                                    <button
                        wire:click="executeCommand('routing')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /routing
                    </button>
                                    <button
                        wire:click="executeCommand('vault')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /vault
                    </button>
                                    <button
                        wire:click="executeCommand('v')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /v
                    </button>
                                    <button
                        wire:click="executeCommand('project')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /project
                    </button>
                                    <button
                        wire:click="executeCommand('p')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /p
                    </button>
                                    <button
                        wire:click="executeCommand('context')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /context
                    </button>
                                    <button
                        wire:click="executeCommand('ctx')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /ctx
                    </button>
                                    <button
                        wire:click="executeCommand('inbox')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /inbox
                    </button>
                                    <button
                        wire:click="executeCommand('in')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /in
                    </button>
                                    <button
                        wire:click="executeCommand('compose')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /compose
                    </button>
                                    <button
                        wire:click="executeCommand('c')"
                        x-on:click="open = false; $nextTick(() => document.querySelector('textarea[x-ref=chatTextarea]')?.focus())"
                        class="w-full text-left bg-gray-800 hover:bg-hot-pink/20 text-gray-300 hover:text-hot-pink rounded-pixel px-3 py-2 text-sm border border-hot-pink/20 transition-colors"
                    >
                        /c
                    </button>
                <!--[if ENDBLOCK]><![endif]-->
            </div>
            <div class="mt-4 text-center">
                <button
                    x-on:click="open = false"
                    class="text-xs text-text-muted hover:text-text-secondary"
                >
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Create Vault Modal -->
    <div
        x-show="$wire.showVaultModal"
        x-transition
        style="display: none;"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
    >
        <div class="bg-gray-900 rounded-pixel p-6 w-96 shadow-xl border border-hot-pink/30">
            <h3 class="text-lg font-semibold mb-4 text-center text-hot-pink">
                <svg class="inline w-5 h-5 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125Z"/>
</svg>                Create New Vault
            </h3>

            <form wire:submit.prevent="createNewVault" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Vault Name *</label>
                    <input
                        type="text"
                        wire:model="newVaultName"
                        class="w-full bg-gray-800 text-gray-200 rounded-pixel p-3 border border-hot-pink/20 focus:ring-1 focus:ring-hot-pink focus:border-hot-pink"
                        placeholder="Enter vault name..."
                        required
                    />
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Description</label>
                    <textarea
                        wire:model="newVaultDescription"
                        class="w-full bg-gray-800 text-gray-200 rounded-pixel p-3 border border-hot-pink/20 focus:ring-1 focus:ring-hot-pink focus:border-hot-pink resize-none"
                        rows="3"
                        placeholder="Brief description (optional)..."
                    ></textarea>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button
                        type="submit"
                        class="flex-1 bg-hot-pink text-white py-2 px-4 rounded-pixel hover:bg-hot-pink/90 transition-colors text-sm font-medium"
                    >
                        Create Vault
                    </button>
                    <button
                        type="button"
                        wire:click="closeVaultModal"
                        class="flex-1 bg-gray-800 text-gray-400 py-2 px-4 rounded-pixel hover:bg-gray-700 transition-colors text-sm font-medium border border-gray-600"
                    >
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div
        x-show="$wire.showProjectModal"
        x-transition
        style="display: none;"
        class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50"
    >
        <div class="bg-gray-900 rounded-pixel p-6 w-96 shadow-xl border border-electric-blue/30">
            <h3 class="text-lg font-semibold mb-4 text-center text-electric-blue">
                <svg class="inline w-5 h-5 mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"/>
</svg>                Create New Project
            </h3>

            <form wire:submit.prevent="createNewProject" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Project Name *</label>
                    <input
                        type="text"
                        wire:model="newProjectName"
                        class="w-full bg-gray-800 text-gray-200 rounded-pixel p-3 border border-electric-blue/20 focus:ring-1 focus:ring-electric-blue focus:border-electric-blue"
                        placeholder="Enter project name..."
                        required
                    />
                </div>

                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Description</label>
                    <textarea
                        wire:model="newProjectDescription"
                        class="w-full bg-gray-800 text-gray-200 rounded-pixel p-3 border border-electric-blue/20 focus:ring-1 focus:ring-electric-blue focus:border-electric-blue resize-none"
                        rows="3"
                        placeholder="Brief description (optional)..."
                    ></textarea>
                </div>

                <div class="flex space-x-3 pt-4">
                    <button
                        type="submit"
                        class="flex-1 bg-electric-blue text-white py-2 px-4 rounded-pixel hover:bg-electric-blue/90 transition-colors text-sm font-medium"
                    >
                        Create Project
                    </button>
                    <button
                        type="button"
                        wire:click="closeProjectModal"
                        class="flex-1 bg-gray-800 text-gray-400 py-2 px-4 rounded-pixel hover:bg-gray-700 transition-colors text-sm font-medium border border-gray-600"
                    >
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Settings Modal -->
    <div
        x-show="$wire.showToastSettings"
        x-transition
        style="display: none;"
        class="fixed inset-0 z-50 overflow-y-auto"
        @keydown.escape="$wire.showToastSettings = false"
    >
        <div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm" @click="$wire.showToastSettings = false"></div>
        <div class="flex min-h-full items-center justify-center p-4">
            <div class="relative bg-surface-2 p-6 rounded-pixel border border-thin border-amber-500/30 max-w-lg w-full mx-auto">
                <div class="mb-4">
                    <h3 class="text-lg font-semibold text-amber-400 mb-2 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM9 12h6m-6-4h6m2 5l-8-5-8 5"/>
                        </svg>
                        Toast Notifications
                    </h3>
                    <p class="text-sm text-gray-400">Choose how many notifications you want to see</p>
                </div>

                <div class="space-y-3 mb-6">
                    <!--[if BLOCK]><![endif]-->                        <label class="flex items-center space-x-3 cursor-pointer group">
                            <input
                                type="radio"
                                name="toast_verbosity"
                                value="minimal"
                                wire:click="updateToastVerbosity('minimal')"
                                
                                class="sr-only"
                            >
                            <div class="relative flex items-center justify-center w-4 h-4 border-2 border-amber-500/50 rounded-full group-hover:border-amber-400 transition-colors">
                                <div
                                    class="w-2 h-2 bg-amber-400 rounded-full transition-opacity opacity-0"
                                ></div>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-200 group-hover:text-amber-100 transition-colors">
                                    Minimal (errors and warnings only)
                                </div>
                                <!--[if BLOCK]><![endif]-->                                    <div class="text-xs text-gray-500">Only errors and warnings</div>
                                <!--[if ENDBLOCK]><![endif]-->
                            </div>
                        </label>
                                            <label class="flex items-center space-x-3 cursor-pointer group">
                            <input
                                type="radio"
                                name="toast_verbosity"
                                value="normal"
                                wire:click="updateToastVerbosity('normal')"
                                checked
                                class="sr-only"
                            >
                            <div class="relative flex items-center justify-center w-4 h-4 border-2 border-amber-500/50 rounded-full group-hover:border-amber-400 transition-colors">
                                <div
                                    class="w-2 h-2 bg-amber-400 rounded-full transition-opacity opacity-100"
                                ></div>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-200 group-hover:text-amber-100 transition-colors">
                                    Normal (all notifications)
                                </div>
                                <!--[if BLOCK]><![endif]-->                                    <div class="text-xs text-gray-500">All notifications (recommended)</div>
                                <!--[if ENDBLOCK]><![endif]-->
                            </div>
                        </label>
                                            <label class="flex items-center space-x-3 cursor-pointer group">
                            <input
                                type="radio"
                                name="toast_verbosity"
                                value="verbose"
                                wire:click="updateToastVerbosity('verbose')"
                                
                                class="sr-only"
                            >
                            <div class="relative flex items-center justify-center w-4 h-4 border-2 border-amber-500/50 rounded-full group-hover:border-amber-400 transition-colors">
                                <div
                                    class="w-2 h-2 bg-amber-400 rounded-full transition-opacity opacity-0"
                                ></div>
                            </div>
                            <div class="flex-1">
                                <div class="text-sm font-medium text-gray-200 group-hover:text-amber-100 transition-colors">
                                    Verbose (all notifications with details)
                                </div>
                                <!--[if BLOCK]><![endif]-->                                    <div class="text-xs text-gray-500">All notifications with extra details</div>
                                <!--[if ENDBLOCK]><![endif]-->
                            </div>
                        </label>
                    <!--[if ENDBLOCK]><![endif]-->
                </div>

                <div class="flex justify-end">
                    <button
                        type="button"
                        wire:click="toggleToastSettings"
                        class="bg-gray-800 text-gray-400 py-2 px-4 rounded-pixel hover:bg-gray-700 transition-colors text-sm font-medium border border-gray-600"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Recall Palette (Ctrl+K Search) - Inline -->
    <div
        x-data="recallPalette"
        x-show="$wire.showRecallPalette"
        x-cloak
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-50 overflow-y-auto"
        @keydown.escape="$wire.closeRecallPalette()"
        @keydown.ctrl.k.prevent="$wire.closeRecallPalette()"
    >
        
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75"></div>

        
        <div class="flex min-h-full items-start justify-center p-4 text-center sm:p-0">
            <div class="relative mt-20 w-full max-w-2xl transform overflow-hidden rounded-xl bg-white dark:bg-gray-800 shadow-2xl transition-all">

                
                <div class="border-b border-gray-200 dark:border-gray-700 px-4 py-4">
                    <div class="relative">
                        <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                            <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <input
                            wire:model.live="recallQuery"
                            type="text"
                            class="w-full pl-10 pr-4 py-3 border-0 text-lg text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 bg-transparent focus:ring-0 focus:outline-none"
                            placeholder="Search fragments... (type:todo #urgent @john has:link)"
                            x-ref="searchInput"
                            x-init="$nextTick(() => $refs.searchInput.focus())"
                            @keydown.arrow-up.prevent="$wire.moveRecallSelection('up')"
                            @keydown.arrow-down.prevent="$wire.moveRecallSelection('down')"
                            @keydown.enter.prevent="if (!$wire.recallLoading) $wire.selectCurrentRecallResult()"
                            autocomplete="off"
                        />
                        <div wire:loading wire:target="performRecallSearch" class="absolute inset-y-0 right-0 flex items-center pr-3">
                            <svg class="animate-spin h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                
                <div class="max-h-96 overflow-y-auto">

                    
                    <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->

                    
                    <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->
                </div>

                
                <div class="border-t border-gray-200 dark:border-gray-700 px-4 py-3 bg-gray-50 dark:bg-gray-750">
                    <div class="flex justify-between items-center text-xs text-gray-500 dark:text-gray-400">
                        <div class="flex space-x-4">
                            <div><kbd class="px-1 py-0.5 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded">↑↓</kbd> Navigate</div>
                            <div><kbd class="px-1 py-0.5 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded">Enter</kbd> Select</div>
                            <div><kbd class="px-1 py-0.5 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded">Esc</kbd> Close</div>
                        </div>
                        <!--[if BLOCK]><![endif]--><!--[if ENDBLOCK]><![endif]-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Initialize Alpine.js components
        document.addEventListener('alpine:init', () => {
            Alpine.data('recallPalette', () => ({
                init() {
                    // Listen for Ctrl+K globally
                    document.addEventListener('keydown', (e) => {
                        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                            e.preventDefault();
                            this.$wire.openRecallPalette();
                        }
                    });
                }
            }));
        });

        // Listen for undo toast events
        document.addEventListener('livewire:init', function() {
            Livewire.on('show-undo-toast', function(event) {
                console.log('Received undo toast event:', event);
                console.log('All arguments:', Array.from(arguments));

                // In Livewire 3, named parameters are passed as properties of the event object
                let fragmentId = event.fragmentId || event.detail?.fragmentId;
                let message = event.message || event.detail?.message;
                let objectType = event.objectType || event.detail?.objectType || 'fragment';

                // Fallback: check if data is in arguments
                if (!fragmentId && arguments.length > 1) {
                    fragmentId = arguments[0]?.fragmentId || arguments[1];
                    message = arguments[0]?.message || arguments[2];
                    objectType = arguments[0]?.objectType || arguments[3] || 'fragment';
                }

                console.log('Extracted values:', { fragmentId, message, objectType });

                if (!fragmentId) {
                    console.error('No fragmentId found in event data');
                    return;
                }

                // Find the undo toast by ID and trigger display
                const toastElement = document.getElementById('undo-toast');
                console.log('Toast element found:', !!toastElement);

                if (toastElement && toastElement._x_dataStack && toastElement._x_dataStack[0]) {
                    console.log('Calling display with:', fragmentId, message, objectType);
                    toastElement._x_dataStack[0].display(fragmentId, message, objectType);
                } else {
                    console.error('Could not find undo toast Alpine component');
                }
            });

            // Also listen for custom browser events as fallback
            window.addEventListener('show-undo-toast', function(event) {
                console.log('Received custom undo toast event:', event.detail);

                const fragmentId = event.detail.fragmentId;
                const message = event.detail.message;
                const objectType = event.detail.objectType || 'fragment';

                console.log('Custom event values:', { fragmentId, message, objectType });

                if (fragmentId) {
                    const toastElement = document.getElementById('undo-toast');
                    if (toastElement && toastElement._x_dataStack && toastElement._x_dataStack[0]) {
                        console.log('Calling display via custom event with:', fragmentId, message, objectType);
                        toastElement._x_dataStack[0].display(fragmentId, message, objectType);
                    }
                }
            });

            // DISABLED: First listener commented out to avoid conflicts
            /*
            // Listen for success toast events (for /frag and /chaos commands)
            Livewire.on('show-success-toast', function(event) {
                console.log('FIRST success toast listener received:', event);

                let title = event.title || event.detail?.title || 'Success';
                let message = event.message || event.detail?.message;
                let fragmentType = event.fragmentType || event.detail?.fragmentType || 'fragment';
                let fragmentId = event.fragmentId || event.detail?.fragmentId || null;

                console.log('FIRST listener success toast values:', { title, message, fragmentType, fragmentId });

                if (message) {
                    const toastElement = document.getElementById('success-toast');
                    if (toastElement && toastElement._x_dataStack && toastElement._x_dataStack[0]) {
                        console.log('FIRST listener calling display with:', title, message, fragmentType, fragmentId);
                        toastElement._x_dataStack[0].display(title, message, fragmentType, fragmentId, 5);
                    } else {
                        console.log('FIRST listener: success-toast element not found or not ready');
                    }
                }
            });
            */

            // Listen for browser success toast events
            window.addEventListener('show-success-toast', function(event) {
                console.log('Received custom success toast event:', event.detail);

                const message = event.detail.message;
                const objectType = event.detail.objectType || 'fragment';

                if (message) {
                    const toastElement = document.getElementById('undo-toast');
                    if (toastElement && toastElement._x_dataStack && toastElement._x_dataStack[0]) {
                        console.log('Calling displaySuccess via custom event with:', message, objectType);
                        toastElement._x_dataStack[0].displaySuccess(message, objectType, 10);
                    }
                }
            });

            Livewire.on('show-error-toast', function(data) {
                // Use the unified undo-toast for error messages
                const toastElement = document.getElementById('undo-toast');
                if (toastElement && toastElement._x_dataStack && toastElement._x_dataStack[0]) {
                    toastElement._x_dataStack[0].displayError(data.message, 2);
                }
            });

            // Handle success toasts with custom titles (for todo creation, etc.)
            Livewire.on('show-success-toast', function(data) {
                console.log('SECOND success toast handler received:', data);

                // Livewire events come as arrays, get the first element
                const eventData = Array.isArray(data) ? data[0] : data;
                console.log('Processed event data:', eventData);
                console.log('Title check:', { title: eventData.title, isCustom: (eventData.title && eventData.title !== 'Success') });

                // If we have a custom title, use success-toast component
                if (eventData.title && eventData.title !== 'Success') {
                    console.log('Attempting to use success-toast for custom title:', eventData.title);
                    const successToastElement = document.getElementById('success-toast');
                    console.log('success-toast element found:', !!successToastElement);

                    if (successToastElement && successToastElement._x_dataStack && successToastElement._x_dataStack[0]) {
                        console.log('SUCCESS: Using success-toast for custom title:', eventData.title);
                        successToastElement._x_dataStack[0].display(
                            eventData.title,
                            eventData.message,
                            eventData.fragmentType || 'fragment',
                            eventData.fragmentId || null,
                            3
                        );
                        return;
                    } else {
                        console.log('FAILED: success-toast element not ready, _x_dataStack:', successToastElement?._x_dataStack);
                    }
                }

                // Fallback to undo-toast for generic messages (like fragment restored)
                console.log('FALLBACK: Using undo-toast for message');
                const undoToastElement = document.getElementById('undo-toast');
                if (undoToastElement && undoToastElement._x_dataStack && undoToastElement._x_dataStack[0]) {
                    console.log('undo-toast element ready, displaying success');
                    undoToastElement._x_dataStack[0].displaySuccess(
                        eventData.message,
                        eventData.fragmentType || 'fragment',
                        2
                    );
                } else {
                    console.log('ERROR: undo-toast element not found or not ready');
                }
            });

        });

        // Bookmark and copy functionality (fallback if link-handler.js not loaded)
        if (!window.checkBookmarkStatus) {
            window.checkBookmarkStatus = async function(fragmentId, element) {
                console.log('checkBookmarkStatus called:', fragmentId, element);
                if (!fragmentId || fragmentId <= 0) return;
                try {
                    const response = await fetch(`/api/fragments/${fragmentId}/bookmark`);
                    if (!response.ok) return;
                    const data = await response.json();
                    console.log('Initial bookmark status data:', data);

                    // Try different ways to access Alpine component
                    let alpineComponent;
                    if (window.Alpine && Alpine.$data) {
                        alpineComponent = Alpine.$data(element);
                    }

                    console.log('Alpine component for status check:', alpineComponent);

                    if (alpineComponent && typeof alpineComponent.bookmarked !== 'undefined') {
                        alpineComponent.bookmarked = data.is_bookmarked;
                        console.log('Set initial bookmarked to:', data.is_bookmarked);
                    } else {
                        console.warn('Could not access Alpine component data for bookmark status');
                        // Fallback: set data attribute for visual state
                        element.setAttribute('data-bookmarked', data.is_bookmarked);
                    }
                } catch (error) {
                    console.error('checkBookmarkStatus error:', error);
                    return;
                }
            };
        }

        if (!window.toggleBookmark) {
            window.toggleBookmark = async function(fragmentId, element) {
                console.log('toggleBookmark called:', fragmentId, element);
                try {
                    const response = await fetch(`/api/fragments/${fragmentId}/bookmark`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || ''
                        }
                    });
                    console.log('Bookmark toggle response status:', response.status);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    console.log('Bookmark toggle data:', data);

                    // Update Alpine component state
                    const alpineComponent = Alpine.$data(element);
                    console.log('Alpine component for toggle:', alpineComponent);
                    if (alpineComponent) {
                        alpineComponent.bookmarked = data.is_bookmarked;
                        console.log('Updated bookmarked state to:', data.is_bookmarked);
                    }

                    // Dispatch event to notify bookmark widget to refresh (CRITICAL for real-time updates)
                    window.dispatchEvent(new CustomEvent('bookmark-toggled', {
                        detail: { fragmentId, action: data.action, isBookmarked: data.is_bookmarked }
                    }));

                } catch (error) {
                    console.error('Failed to toggle bookmark:', error.message);
                }
            };
        }

        if (!window.copyChatMessage) {
            window.copyChatMessage = async function(button) {
                try {
                    let messageContainer = button.parentElement;
                    while (messageContainer && !messageContainer.classList.contains('relative')) {
                        messageContainer = messageContainer.parentElement;
                    }
                    if (!messageContainer) {
                        messageContainer = button.closest('div.flex-1, div[class*="bg-surface-card"]');
                    }
                    if (!messageContainer) throw new Error('Could not find message container');

                    const clonedContainer = messageContainer.cloneNode(true);
                    const copyButton = clonedContainer.querySelector('button');
                    if (copyButton) copyButton.remove();

                    let text = clonedContainer.textContent || clonedContainer.innerText;
                    text = text.replace(/📋\s*Copy/g, '').replace(/✅\s*Copied!/g, '').replace(/❌\s*Failed/g, '').trim();

                    if (!text || text.length === 0) throw new Error('No text content found');

                    await navigator.clipboard.writeText(text);

                    const originalHtml = button.innerHTML;
                    button.innerHTML = '✅ Copied!';
                    button.classList.add('text-green-400', 'border-green-400/40');
                    button.classList.remove('text-neon-cyan', 'border-neon-cyan/40');

                    setTimeout(() => {
                        button.innerHTML = originalHtml;
                        button.classList.remove('text-green-400', 'border-green-400/40');
                        button.classList.add('text-neon-cyan', 'border-neon-cyan/40');
                    }, 2000);

                } catch (error) {
                    console.error('Failed to copy message:', error);
                    const originalHtml = button.innerHTML;
                    button.innerHTML = '❌ Failed';
                    button.classList.add('text-red-400', 'border-red-400/40');
                    setTimeout(() => {
                        button.innerHTML = originalHtml;
                        button.classList.remove('text-red-400', 'border-red-400/40');
                    }, 2000);
                }
            };
        }
    </script>

</div>

    <!-- Livewire Scripts -->
<script src="/livewire/livewire.js?id=df3a17f2"   data-csrf="M22wAfnPk6vXqsiNdE6CLrsH9OLvT90ddygiSZCg" data-update-uri="/livewire/update" data-navigate-once="true"></script>


    <script>
        // Auto-scroll chat to bottom
        document.addEventListener('DOMContentLoaded', function() {
            const chatContent = document.querySelector('#chat-output');
            if (chatContent) {
                chatContent.scrollTop = chatContent.scrollHeight;
            }
        });

        // Auto-scroll on new messages (Livewire updates)
        document.addEventListener('livewire:update', function() {
            const chatContent = document.querySelector('#chat-output');
            if (chatContent) {
                chatContent.scrollTop = chatContent.scrollHeight;
            }
        });

        // Auto-refresh sortable on Livewire updates
        document.addEventListener('livewire:update', function() {
            const container = document.getElementById('pinned-chats-container');
            if (container && window.pinnedChatsSortable) {
                window.pinnedChatsSortable.destroy();
                initPinnedChatsSortable();
            }
        });
    </script>
</body>
</html>
