{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "UI Builder Page Configuration",
  "description": "JSON Schema for UI Builder page configurations (v2.1.0)",
  "type": "object",
  "required": ["id", "overlay", "title", "layout"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique page identifier",
      "pattern": "^page\\.[a-z0-9-]+\\.[a-z0-9-]+$",
      "examples": ["page.ui-builder.pages.list", "page.custom.dashboard"]
    },
    "overlay": {
      "type": "string",
      "enum": ["page", "modal", "drawer"],
      "description": "How the page is displayed"
    },
    "title": {
      "type": "string",
      "description": "Page title displayed to user",
      "minLength": 1
    },
    "layout": {
      "$ref": "#/definitions/LayoutConfig"
    },
    "meta": {
      "type": "object",
      "description": "Additional metadata",
      "additionalProperties": true
    }
  },
  "definitions": {
    "LayoutConfig": {
      "type": "object",
      "required": ["type", "id", "children"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["rows", "columns", "grid", "stack"],
          "description": "Layout direction/type"
        },
        "id": {
          "type": "string",
          "description": "Unique layout identifier",
          "examples": ["root-layout", "main-content"]
        },
        "children": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ComponentConfig"
          },
          "minItems": 0
        },
        "props": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "ComponentConfig": {
      "type": "object",
      "required": ["id", "type"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique component instance ID",
          "pattern": "^component\\.[a-z0-9-\\.]+$",
          "examples": ["component.table.agents", "component.button.create"]
        },
        "type": {
          "type": "string",
          "description": "Component type",
          "examples": ["button", "data-table", "search.bar", "card", "input"]
        },
        "props": {
          "type": "object",
          "description": "Component-specific properties",
          "additionalProperties": true
        },
        "actions": {
          "type": "object",
          "description": "Event handlers",
          "properties": {
            "click": {
              "$ref": "#/definitions/ActionConfig"
            },
            "rowClick": {
              "$ref": "#/definitions/ActionConfig"
            },
            "submit": {
              "$ref": "#/definitions/ActionConfig"
            }
          },
          "additionalProperties": {
            "$ref": "#/definitions/ActionConfig"
          }
        },
        "result": {
          "type": "object",
          "description": "For search components - where results go",
          "required": ["target", "open"],
          "properties": {
            "target": {
              "type": "string",
              "description": "Target component ID"
            },
            "open": {
              "type": "string",
              "enum": ["inline", "modal"]
            }
          }
        },
        "children": {
          "type": "array",
          "description": "Child components (for containers)",
          "items": {
            "$ref": "#/definitions/ComponentConfig"
          }
        }
      }
    },
    "ActionConfig": {
      "oneOf": [
        {
          "$ref": "#/definitions/CommandAction"
        },
        {
          "$ref": "#/definitions/ModalAction"
        },
        {
          "$ref": "#/definitions/NavigateAction"
        },
        {
          "$ref": "#/definitions/HttpAction"
        },
        {
          "$ref": "#/definitions/EmitAction"
        }
      ]
    },
    "CommandAction": {
      "type": "object",
      "required": ["type", "command"],
      "properties": {
        "type": {
          "const": "command"
        },
        "command": {
          "type": "string",
          "description": "Command name to execute",
          "examples": ["agent:create", "page:refresh"]
        },
        "params": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "ModalAction": {
      "type": "object",
      "required": ["type", "title", "url", "fields"],
      "properties": {
        "type": {
          "const": "modal"
        },
        "title": {
          "type": "string",
          "description": "Modal title"
        },
        "url": {
          "type": "string",
          "description": "URL to fetch data (supports {{row.id}} template)",
          "examples": [
            "/api/ui/datasources/Agent/{{row.id}}",
            "/api/ui/forms/create-agent"
          ]
        },
        "fields": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/FieldConfig"
          }
        },
        "modal": {
          "type": "string",
          "enum": ["detail", "form"]
        }
      }
    },
    "NavigateAction": {
      "type": "object",
      "required": ["type", "url"],
      "properties": {
        "type": {
          "const": "navigate"
        },
        "url": {
          "type": "string",
          "description": "URL to navigate to"
        }
      }
    },
    "HttpAction": {
      "type": "object",
      "required": ["type", "url", "method"],
      "properties": {
        "type": {
          "const": "http"
        },
        "url": {
          "type": "string",
          "description": "API endpoint"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"]
        },
        "payload": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "EmitAction": {
      "type": "object",
      "required": ["type", "event"],
      "properties": {
        "type": {
          "const": "emit"
        },
        "event": {
          "type": "string",
          "description": "Event name to emit"
        },
        "payload": {
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "FieldConfig": {
      "type": "object",
      "required": ["key", "label", "type"],
      "properties": {
        "key": {
          "type": "string",
          "description": "Data key to display"
        },
        "label": {
          "type": "string",
          "description": "Field label"
        },
        "type": {
          "type": "string",
          "enum": ["text", "date", "datetime", "number", "boolean", "badge", "json"]
        },
        "render": {
          "type": "string",
          "description": "Custom renderer name"
        }
      }
    },
    "ColumnConfig": {
      "type": "object",
      "required": ["key", "label"],
      "properties": {
        "key": {
          "type": "string",
          "description": "Data key to display"
        },
        "label": {
          "type": "string",
          "description": "Column header"
        },
        "sortable": {
          "type": "boolean",
          "default": false
        },
        "filterable": {
          "type": "boolean",
          "default": false
        },
        "render": {
          "type": "string",
          "description": "Renderer type",
          "examples": ["badge", "date", "currency"]
        },
        "width": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "number"
            }
          ]
        }
      }
    },
    "DataTableProps": {
      "type": "object",
      "required": ["dataSource", "columns"],
      "properties": {
        "dataSource": {
          "type": "string",
          "description": "DataSource alias",
          "examples": ["Agent", "UiPage", "UiComponent"]
        },
        "columns": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ColumnConfig"
          },
          "minItems": 1
        },
        "rowAction": {
          "$ref": "#/definitions/ActionConfig"
        },
        "toolbar": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ComponentConfig"
          }
        },
        "pagination": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "pageSize": {
              "type": "number",
              "minimum": 1,
              "maximum": 100,
              "default": 15
            }
          }
        },
        "selection": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "type": {
              "type": "string",
              "enum": ["single", "multiple"]
            }
          }
        },
        "emptyText": {
          "type": "string",
          "default": "No data available"
        }
      }
    }
  },
  "examples": [
    {
      "id": "page.custom.agents",
      "overlay": "page",
      "title": "Agents Management",
      "layout": {
        "type": "rows",
        "id": "root-layout",
        "children": [
          {
            "id": "component.search.agents",
            "type": "search.bar",
            "props": {
              "placeholder": "Search agents..."
            },
            "result": {
              "target": "component.table.agents",
              "open": "inline"
            }
          },
          {
            "id": "component.table.agents",
            "type": "data-table",
            "props": {
              "dataSource": "Agent",
              "columns": [
                {
                  "key": "name",
                  "label": "Name",
                  "sortable": true
                },
                {
                  "key": "status",
                  "label": "Status",
                  "filterable": true
                }
              ],
              "rowAction": {
                "type": "modal",
                "title": "Agent Details",
                "url": "/api/ui/datasources/Agent/{{row.id}}",
                "fields": [
                  {
                    "key": "name",
                    "label": "Name",
                    "type": "text"
                  },
                  {
                    "key": "created_at",
                    "label": "Created",
                    "type": "date"
                  }
                ]
              }
            }
          }
        ]
      }
    }
  ]
}
