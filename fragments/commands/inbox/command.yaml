name: "Inbox Management (Unified)"
slug: inbox
version: 2.0.0
triggers:
  slash: "/inbox"
  aliases: ["/in"]
  input_mode: "inline"
reserved: true

requires:
  secrets: []
  capabilities: ["fragment.query"]

steps:
  - id: coerce-input
    type: transform
    template: |
      {{ ctx.body }}

  - id: check-api-mode
    type: condition
    condition: "{{ steps.coerce-input.output == 'api' }}"
    then:
      - id: display-api-help
        type: notify
        with:
          message: |
            ðŸ“¥ **Inbox API Reference**
            
            Use `/api/inbox` endpoint to view pending fragments.
            
            **Available filters:**
            - type: Filter by fragment type
            - tags: Filter by tags  
            - category: Filter by category
            - vault: Filter by vault
            - limit: Number of results (default: 10)
            
            **Example:**
            GET /api/inbox?type=todo&limit=20
            
            **Inbox Views:**
            - /inbox - Recent items and open todos
            - /inbox bookmarked - Bookmarked fragments  
            - /inbox todos - Todo-specific view
            - /inbox all - All actionable items
          level: "info"
    else:
      - id: query-pending
        type: fragment.query
        with:
          type: "todo"
          filters:
            state.status: "open"
          limit: 20
          order: "created_at desc"
          with_relations: ["type"]

      - id: display-pending
        type: response.panel
        with:
          type: "inbox"
          message: "ðŸ“¥ Found pending items in your inbox"
          shouldOpenPanel: true
          panel_data:
            action: "pending"
            type: "pending"
            fragments: "{{ steps.query-pending.output.fragments }}"